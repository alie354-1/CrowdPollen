import{r as m,a as ss,R as as,b as rs}from"./vendor-C1JoJ-56.js";import{c as os,_ as ye}from"./services-JCfgYN9M.js";import{H as Ie,C as ee,M as Me,F as ns,a as V,T as je,N as Ge,L as st,I as xe,U as vt,b as ls,c as is,A as Y,X as Ue,Z as cs,d as ds,R as ms,e as us,f as hs,g as xs,h as gs,i as fe,S as ps,j as ve,k as We,l as at,P as rt,m as fs,B as Fe,n as ys,o as bs,D as wt,p as js,G as Nt,q as pe,r as ze,s as vs,t as St,u as Ee,v as He,w as ot,x as nt,y as lt,z as ws}from"./ui-CQFHDhIM.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function a(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=a(o);fetch(o.href,l)}})();var Ct={exports:{}},Te={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ns=m,Ss=Symbol.for("react.element"),Cs=Symbol.for("react.fragment"),ks=Object.prototype.hasOwnProperty,Ps=Ns.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,As={key:!0,ref:!0,__self:!0,__source:!0};function kt(s,t,a){var r,o={},l=null,n=null;a!==void 0&&(l=""+a),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(n=t.ref);for(r in t)ks.call(t,r)&&!As.hasOwnProperty(r)&&(o[r]=t[r]);if(s&&s.defaultProps)for(r in t=s.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:Ss,type:s,key:l,ref:n,props:o,_owner:Ps.current}}Te.Fragment=Cs;Te.jsx=kt;Te.jsxs=kt;Ct.exports=Te;var e=Ct.exports,Be={},it=ss;Be.createRoot=it.createRoot,Be.hydrateRoot=it.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function we(){return we=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},we.apply(this,arguments)}var ae;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(ae||(ae={}));const ct="popstate";function Is(s){s===void 0&&(s={});function t(r,o){let{pathname:l,search:n,hash:c}=r.location;return qe("",{pathname:l,search:n,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function a(r,o){return typeof o=="string"?o:At(o)}return Ms(t,a,null,s)}function $(s,t){if(s===!1||s===null||typeof s>"u")throw new Error(t)}function Pt(s,t){if(!s){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function _s(){return Math.random().toString(36).substr(2,8)}function dt(s,t){return{usr:s.state,key:s.key,idx:t}}function qe(s,t,a,r){return a===void 0&&(a=null),we({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof t=="string"?be(t):t,{state:a,key:t&&t.key||r||_s()})}function At(s){let{pathname:t="/",search:a="",hash:r=""}=s;return a&&a!=="?"&&(t+=a.charAt(0)==="?"?a:"?"+a),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function be(s){let t={};if(s){let a=s.indexOf("#");a>=0&&(t.hash=s.substr(a),s=s.substr(0,a));let r=s.indexOf("?");r>=0&&(t.search=s.substr(r),s=s.substr(0,r)),s&&(t.pathname=s)}return t}function Ms(s,t,a,r){r===void 0&&(r={});let{window:o=document.defaultView,v5Compat:l=!1}=r,n=o.history,c=ae.Pop,i=null,d=u();d==null&&(d=0,n.replaceState(we({},n.state,{idx:d}),""));function u(){return(n.state||{idx:null}).idx}function x(){c=ae.Pop;let w=u(),j=w==null?null:w-d;d=w,i&&i({action:c,location:y.location,delta:j})}function P(w,j){c=ae.Push;let p=qe(y.location,w,j);d=u()+1;let N=dt(p,d),h=y.createHref(p);try{n.pushState(N,"",h)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;o.location.assign(h)}l&&i&&i({action:c,location:y.location,delta:1})}function S(w,j){c=ae.Replace;let p=qe(y.location,w,j);d=u();let N=dt(p,d),h=y.createHref(p);n.replaceState(N,"",h),l&&i&&i({action:c,location:y.location,delta:0})}function g(w){let j=o.location.origin!=="null"?o.location.origin:o.location.href,p=typeof w=="string"?w:At(w);return p=p.replace(/ $/,"%20"),$(j,"No window.location.(origin|href) available to create URL for href: "+p),new URL(p,j)}let y={get action(){return c},get location(){return s(o,n)},listen(w){if(i)throw new Error("A history only accepts one active listener");return o.addEventListener(ct,x),i=w,()=>{o.removeEventListener(ct,x),i=null}},createHref(w){return t(o,w)},createURL:g,encodeLocation(w){let j=g(w);return{pathname:j.pathname,search:j.search,hash:j.hash}},push:P,replace:S,go(w){return n.go(w)}};return y}var mt;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(mt||(mt={}));function Es(s,t,a){return a===void 0&&(a="/"),Ts(s,t,a)}function Ts(s,t,a,r){let o=typeof t=="string"?be(t):t,l=Mt(o.pathname||"/",a);if(l==null)return null;let n=It(s);Ls(n);let c=null;for(let i=0;c==null&&i<n.length;++i){let d=qs(l);c=zs(n[i],d)}return c}function It(s,t,a,r){t===void 0&&(t=[]),a===void 0&&(a=[]),r===void 0&&(r="");let o=(l,n,c)=>{let i={relativePath:c===void 0?l.path||"":c,caseSensitive:l.caseSensitive===!0,childrenIndex:n,route:l};i.relativePath.startsWith("/")&&($(i.relativePath.startsWith(r),'Absolute route path "'+i.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),i.relativePath=i.relativePath.slice(r.length));let d=ce([r,i.relativePath]),u=a.concat(i);l.children&&l.children.length>0&&($(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),It(l.children,t,u,d)),!(l.path==null&&!l.index)&&t.push({path:d,score:Us(d,l.index),routesMeta:u})};return s.forEach((l,n)=>{var c;if(l.path===""||!((c=l.path)!=null&&c.includes("?")))o(l,n);else for(let i of _t(l.path))o(l,n,i)}),t}function _t(s){let t=s.split("/");if(t.length===0)return[];let[a,...r]=t,o=a.endsWith("?"),l=a.replace(/\?$/,"");if(r.length===0)return o?[l,""]:[l];let n=_t(r.join("/")),c=[];return c.push(...n.map(i=>i===""?l:[l,i].join("/"))),o&&c.push(...n),c.map(i=>s.startsWith("/")&&i===""?"/":i)}function Ls(s){s.sort((t,a)=>t.score!==a.score?a.score-t.score:Ws(t.routesMeta.map(r=>r.childrenIndex),a.routesMeta.map(r=>r.childrenIndex)))}const Ds=/^:[\w-]+$/,Rs=3,Os=2,Fs=1,$s=10,Gs=-2,ut=s=>s==="*";function Us(s,t){let a=s.split("/"),r=a.length;return a.some(ut)&&(r+=Gs),t&&(r+=Os),a.filter(o=>!ut(o)).reduce((o,l)=>o+(Ds.test(l)?Rs:l===""?Fs:$s),r)}function Ws(s,t){return s.length===t.length&&s.slice(0,-1).every((r,o)=>r===t[o])?s[s.length-1]-t[t.length-1]:0}function zs(s,t,a){let{routesMeta:r}=s,o={},l="/",n=[];for(let c=0;c<r.length;++c){let i=r[c],d=c===r.length-1,u=l==="/"?t:t.slice(l.length)||"/",x=Hs({path:i.relativePath,caseSensitive:i.caseSensitive,end:d},u),P=i.route;if(!x)return null;Object.assign(o,x.params),n.push({params:o,pathname:ce([l,x.pathname]),pathnameBase:Js(ce([l,x.pathnameBase])),route:P}),x.pathnameBase!=="/"&&(l=ce([l,x.pathnameBase]))}return n}function Hs(s,t){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[a,r]=Bs(s.path,s.caseSensitive,s.end),o=t.match(a);if(!o)return null;let l=o[0],n=l.replace(/(.)\/+$/,"$1"),c=o.slice(1);return{params:r.reduce((d,u,x)=>{let{paramName:P,isOptional:S}=u;if(P==="*"){let y=c[x]||"";n=l.slice(0,l.length-y.length).replace(/(.)\/+$/,"$1")}const g=c[x];return S&&!g?d[P]=void 0:d[P]=(g||"").replace(/%2F/g,"/"),d},{}),pathname:l,pathnameBase:n,pattern:s}}function Bs(s,t,a){t===void 0&&(t=!1),a===void 0&&(a=!0),Pt(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let r=[],o="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(n,c,i)=>(r.push({paramName:c,isOptional:i!=null}),i?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(r.push({paramName:"*"}),o+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?o+="\\/*$":s!==""&&s!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),r]}function qs(s){try{return s.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Pt(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),s}}function Mt(s,t){if(t==="/")return s;if(!s.toLowerCase().startsWith(t.toLowerCase()))return null;let a=t.endsWith("/")?t.length-1:t.length,r=s.charAt(a);return r&&r!=="/"?null:s.slice(a)||"/"}function Vs(s,t){t===void 0&&(t="/");let{pathname:a,search:r="",hash:o=""}=typeof s=="string"?be(s):s;return{pathname:a?a.startsWith("/")?a:Ys(a,t):t,search:Zs(r),hash:Qs(o)}}function Ys(s,t){let a=t.replace(/\/+$/,"").split("/");return s.split("/").forEach(o=>{o===".."?a.length>1&&a.pop():o!=="."&&a.push(o)}),a.length>1?a.join("/"):"/"}function $e(s,t,a,r){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ks(s){return s.filter((t,a)=>a===0||t.route.path&&t.route.path.length>0)}function Et(s,t){let a=Ks(s);return t?a.map((r,o)=>o===a.length-1?r.pathname:r.pathnameBase):a.map(r=>r.pathnameBase)}function Tt(s,t,a,r){r===void 0&&(r=!1);let o;typeof s=="string"?o=be(s):(o=we({},s),$(!o.pathname||!o.pathname.includes("?"),$e("?","pathname","search",o)),$(!o.pathname||!o.pathname.includes("#"),$e("#","pathname","hash",o)),$(!o.search||!o.search.includes("#"),$e("#","search","hash",o)));let l=s===""||o.pathname==="",n=l?"/":o.pathname,c;if(n==null)c=a;else{let x=t.length-1;if(!r&&n.startsWith("..")){let P=n.split("/");for(;P[0]==="..";)P.shift(),x-=1;o.pathname=P.join("/")}c=x>=0?t[x]:"/"}let i=Vs(o,c),d=n&&n!=="/"&&n.endsWith("/"),u=(l||n===".")&&a.endsWith("/");return!i.pathname.endsWith("/")&&(d||u)&&(i.pathname+="/"),i}const ce=s=>s.join("/").replace(/\/\/+/g,"/"),Js=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),Zs=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,Qs=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function Xs(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const Lt=["post","put","patch","delete"];new Set(Lt);const ea=["get",...Lt];new Set(ea);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ne(){return Ne=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])}return s},Ne.apply(this,arguments)}const Ye=m.createContext(null),ta=m.createContext(null),Se=m.createContext(null),Le=m.createContext(null),ue=m.createContext({outlet:null,matches:[],isDataRoute:!1}),Dt=m.createContext(null);function Ce(){return m.useContext(Le)!=null}function De(){return Ce()||$(!1),m.useContext(Le).location}function Rt(s){m.useContext(Se).static||m.useLayoutEffect(s)}function oe(){let{isDataRoute:s}=m.useContext(ue);return s?xa():sa()}function sa(){Ce()||$(!1);let s=m.useContext(Ye),{basename:t,future:a,navigator:r}=m.useContext(Se),{matches:o}=m.useContext(ue),{pathname:l}=De(),n=JSON.stringify(Et(o,a.v7_relativeSplatPath)),c=m.useRef(!1);return Rt(()=>{c.current=!0}),m.useCallback(function(d,u){if(u===void 0&&(u={}),!c.current)return;if(typeof d=="number"){r.go(d);return}let x=Tt(d,JSON.parse(n),l,u.relative==="path");s==null&&t!=="/"&&(x.pathname=x.pathname==="/"?t:ce([t,x.pathname])),(u.replace?r.replace:r.push)(x,u.state,u)},[t,r,n,l,s])}function aa(s,t){return ra(s,t)}function ra(s,t,a,r){Ce()||$(!1);let{navigator:o}=m.useContext(Se),{matches:l}=m.useContext(ue),n=l[l.length-1],c=n?n.params:{};n&&n.pathname;let i=n?n.pathnameBase:"/";n&&n.route;let d=De(),u;if(t){var x;let w=typeof t=="string"?be(t):t;i==="/"||(x=w.pathname)!=null&&x.startsWith(i)||$(!1),u=w}else u=d;let P=u.pathname||"/",S=P;if(i!=="/"){let w=i.replace(/^\//,"").split("/");S="/"+P.replace(/^\//,"").split("/").slice(w.length).join("/")}let g=Es(s,{pathname:S}),y=ca(g&&g.map(w=>Object.assign({},w,{params:Object.assign({},c,w.params),pathname:ce([i,o.encodeLocation?o.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?i:ce([i,o.encodeLocation?o.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),l,a,r);return t&&y?m.createElement(Le.Provider,{value:{location:Ne({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:ae.Pop}},y):y}function oa(){let s=ha(),t=Xs(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),a=s instanceof Error?s.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return m.createElement(m.Fragment,null,m.createElement("h2",null,"Unexpected Application Error!"),m.createElement("h3",{style:{fontStyle:"italic"}},t),a?m.createElement("pre",{style:o},a):null,null)}const na=m.createElement(oa,null);class la extends m.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,a){return a.location!==t.location||a.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:a.error,location:a.location,revalidation:t.revalidation||a.revalidation}}componentDidCatch(t,a){console.error("React Router caught the following error during render",t,a)}render(){return this.state.error!==void 0?m.createElement(ue.Provider,{value:this.props.routeContext},m.createElement(Dt.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ia(s){let{routeContext:t,match:a,children:r}=s,o=m.useContext(Ye);return o&&o.static&&o.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=a.route.id),m.createElement(ue.Provider,{value:t},r)}function ca(s,t,a,r){var o;if(t===void 0&&(t=[]),a===void 0&&(a=null),r===void 0&&(r=null),s==null){var l;if(!a)return null;if(a.errors)s=a.matches;else if((l=r)!=null&&l.v7_partialHydration&&t.length===0&&!a.initialized&&a.matches.length>0)s=a.matches;else return null}let n=s,c=(o=a)==null?void 0:o.errors;if(c!=null){let u=n.findIndex(x=>x.route.id&&(c==null?void 0:c[x.route.id])!==void 0);u>=0||$(!1),n=n.slice(0,Math.min(n.length,u+1))}let i=!1,d=-1;if(a&&r&&r.v7_partialHydration)for(let u=0;u<n.length;u++){let x=n[u];if((x.route.HydrateFallback||x.route.hydrateFallbackElement)&&(d=u),x.route.id){let{loaderData:P,errors:S}=a,g=x.route.loader&&P[x.route.id]===void 0&&(!S||S[x.route.id]===void 0);if(x.route.lazy||g){i=!0,d>=0?n=n.slice(0,d+1):n=[n[0]];break}}}return n.reduceRight((u,x,P)=>{let S,g=!1,y=null,w=null;a&&(S=c&&x.route.id?c[x.route.id]:void 0,y=x.route.errorElement||na,i&&(d<0&&P===0?(ga("route-fallback"),g=!0,w=null):d===P&&(g=!0,w=x.route.hydrateFallbackElement||null)));let j=t.concat(n.slice(0,P+1)),p=()=>{let N;return S?N=y:g?N=w:x.route.Component?N=m.createElement(x.route.Component,null):x.route.element?N=x.route.element:N=u,m.createElement(ia,{match:x,routeContext:{outlet:u,matches:j,isDataRoute:a!=null},children:N})};return a&&(x.route.ErrorBoundary||x.route.errorElement||P===0)?m.createElement(la,{location:a.location,revalidation:a.revalidation,component:y,error:S,children:p(),routeContext:{outlet:null,matches:j,isDataRoute:!0}}):p()},null)}var Ot=function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s}(Ot||{}),Ft=function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s}(Ft||{});function da(s){let t=m.useContext(Ye);return t||$(!1),t}function ma(s){let t=m.useContext(ta);return t||$(!1),t}function ua(s){let t=m.useContext(ue);return t||$(!1),t}function $t(s){let t=ua(),a=t.matches[t.matches.length-1];return a.route.id||$(!1),a.route.id}function ha(){var s;let t=m.useContext(Dt),a=ma(),r=$t();return t!==void 0?t:(s=a.errors)==null?void 0:s[r]}function xa(){let{router:s}=da(Ot.UseNavigateStable),t=$t(Ft.UseNavigateStable),a=m.useRef(!1);return Rt(()=>{a.current=!0}),m.useCallback(function(o,l){l===void 0&&(l={}),a.current&&(typeof o=="number"?s.navigate(o):s.navigate(o,Ne({fromRouteId:t},l)))},[s,t])}const ht={};function ga(s,t,a){ht[s]||(ht[s]=!0)}function pa(s,t){s==null||s.v7_startTransition,s==null||s.v7_relativeSplatPath}function fa(s){let{to:t,replace:a,state:r,relative:o}=s;Ce()||$(!1);let{future:l,static:n}=m.useContext(Se),{matches:c}=m.useContext(ue),{pathname:i}=De(),d=oe(),u=Tt(t,Et(c,l.v7_relativeSplatPath),i,o==="path"),x=JSON.stringify(u);return m.useEffect(()=>d(JSON.parse(x),{replace:a,state:r,relative:o}),[d,x,o,a,r]),null}function Z(s){$(!1)}function ya(s){let{basename:t="/",children:a=null,location:r,navigationType:o=ae.Pop,navigator:l,static:n=!1,future:c}=s;Ce()&&$(!1);let i=t.replace(/^\/*/,"/"),d=m.useMemo(()=>({basename:i,navigator:l,static:n,future:Ne({v7_relativeSplatPath:!1},c)}),[i,c,l,n]);typeof r=="string"&&(r=be(r));let{pathname:u="/",search:x="",hash:P="",state:S=null,key:g="default"}=r,y=m.useMemo(()=>{let w=Mt(u,i);return w==null?null:{location:{pathname:w,search:x,hash:P,state:S,key:g},navigationType:o}},[i,u,x,P,S,g,o]);return y==null?null:m.createElement(Se.Provider,{value:d},m.createElement(Le.Provider,{children:a,value:y}))}function ba(s){let{children:t,location:a}=s;return aa(Ve(t),a)}new Promise(()=>{});function Ve(s,t){t===void 0&&(t=[]);let a=[];return m.Children.forEach(s,(r,o)=>{if(!m.isValidElement(r))return;let l=[...t,o];if(r.type===m.Fragment){a.push.apply(a,Ve(r.props.children,l));return}r.type!==Z&&$(!1),!r.props.index||!r.props.children||$(!1);let n={id:r.props.id||l.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(n.children=Ve(r.props.children,l)),a.push(n)}),a}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const ja="6";try{window.__reactRouterVersion=ja}catch{}const va="startTransition",xt=as[va];function wa(s){let{basename:t,children:a,future:r,window:o}=s,l=m.useRef();l.current==null&&(l.current=Is({window:o,v5Compat:!0}));let n=l.current,[c,i]=m.useState({action:n.action,location:n.location}),{v7_startTransition:d}=r||{},u=m.useCallback(x=>{d&&xt?xt(()=>i(x)):i(x)},[i,d]);return m.useLayoutEffect(()=>n.listen(u),[n,u]),m.useEffect(()=>pa(r),[r]),m.createElement(ya,{basename:t,children:a,location:c.location,navigationType:c.action,navigator:n,future:r})}var gt;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(gt||(gt={}));var pt;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(pt||(pt={}));const Na="https://ujpwvxufomnqurvvptki.supabase.co",Sa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqcHd2eHVmb21ucXVydnZwdGtpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0Njk5NzIsImV4cCI6MjA2NzA0NTk3Mn0.AGYFVJj_KSmQaWI6ctLhUjZjHQmiyHS82clcUxDN_Gs",W=os(Na,Sa),Ca=async(s,t="pollen-images")=>{const a=`${Date.now()}-${s.name}`,{data:r,error:o}=await W.storage.from(t).upload(a,s);if(o)throw o;const{data:{publicUrl:l}}=W.storage.from(t).getPublicUrl(a);return{fileName:a,publicUrl:l}},ka=async s=>{const{data:t,error:a}=await W.from("submissions").insert(s).select().single();if(a)throw a;return t},Pa=async(s={})=>{let t=W.from("submissions").select("*").order("created_at",{ascending:!1});s.limit&&(t=t.limit(s.limit)),s.userId&&(t=t.eq("user_id",s.userId));const{data:a,error:r}=await t;if(r)throw r;return a||[]},ke=Object.freeze(Object.defineProperty({__proto__:null,getSubmissions:Pa,saveSubmission:ka,supabase:W,uploadImage:Ca},Symbol.toStringTag,{value:"Module"})),Gt=m.createContext({});function Pe(){const s=m.useContext(Gt);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s}function Aa({children:s}){const[t,a]=m.useState(null),[r,o]=m.useState(null),[l,n]=m.useState(!0),[c,i]=m.useState(!0);m.useEffect(()=>{d();const{data:{subscription:h}}=W.auth.onAuthStateChange(async(b,f)=>{f!=null&&f.user?(a(f.user),i(!1),await u(f.user.id)):(a(null),o(null),i(!0)),n(!1)});return()=>h.unsubscribe()},[]);const d=async()=>{try{const{data:{session:h}}=await W.auth.getSession();h!=null&&h.user?(a(h.user),i(!1),await u(h.user.id)):i(!0)}catch(h){console.error("Error getting initial session:",h)}finally{n(!1)}},u=async h=>{try{const{data:b,error:f}=await W.from("user_profiles").select("*").eq("user_id",h).single();if(f&&f.code!=="PGRST116")throw f;b?o(b):await x(h)}catch(b){console.error("Error loading user profile:",b)}},x=async h=>{var b;try{const{data:f,error:k}=await W.from("user_profiles").insert({user_id:h,display_name:((b=t==null?void 0:t.user_metadata)==null?void 0:b.display_name)||null,privacy_level:"anonymous",account_type:"individual",notification_preferences:{symptom_reminders:!0,high_pollen_alerts:!0,weekly_reports:!1}}).select().single();if(k)throw k;o(f)}catch(f){console.error("Error creating user profile:",f)}},P=async(h,b,f={})=>{try{n(!0);const{data:k,error:I}=await W.auth.signUp({email:h,password:b,options:{data:f}});if(I)throw I;return{data:k,error:null}}catch(k){return console.error("Sign up error:",k),{data:null,error:k}}finally{n(!1)}},S=async(h,b)=>{try{n(!0);const{data:f,error:k}=await W.auth.signInWithPassword({email:h,password:b});if(k)throw k;return{data:f,error:null}}catch(f){return console.error("Sign in error:",f),{data:null,error:f}}finally{n(!1)}},g=async()=>{try{n(!0);const{error:h}=await W.auth.signOut();if(h)throw h;a(null),o(null),i(!0)}catch(h){console.error("Sign out error:",h)}finally{n(!1)}},N={user:t,profile:r,loading:l,isAnonymous:c,signUp:P,signIn:S,signOut:g,updateProfile:async h=>{try{if(!t)throw new Error("No user logged in");const{data:b,error:f}=await W.from("user_profiles").update(h).eq("user_id",t.id).select().single();if(f)throw f;return o(b),{data:b,error:null}}catch(b){return console.error("Update profile error:",b),{data:null,error:b}}},resetPassword:async h=>{try{const{data:b,error:f}=await W.auth.resetPasswordForEmail(h,{redirectTo:`${window.location.origin}/reset-password`});if(f)throw f;return{data:b,error:null}}catch(b){return console.error("Reset password error:",b),{data:null,error:b}}},updatePassword:async h=>{try{const{data:b,error:f}=await W.auth.updateUser({password:h});if(f)throw f;return{data:b,error:null}}catch(b){return console.error("Update password error:",b),{data:null,error:b}}},deleteAccount:async()=>{try{if(!t)throw new Error("No user logged in");const{error:h}=await W.from("user_profiles").delete().eq("user_id",t.id);if(h)throw h;return await g(),{error:null}}catch(h){return console.error("Delete account error:",h),{error:h}}},isAuthenticated:!!t,hasProfile:!!r};return e.jsx(Gt.Provider,{value:N,children:s})}class Ia{constructor(){this.storageKey="crowdpollen_api_monitoring",this.initializeStorage()}initializeStorage(){try{if(!localStorage.getItem(this.storageKey)){const a={daily:{},hourly:{},lastCleanup:Date.now()};localStorage.setItem(this.storageKey,JSON.stringify(a))}}catch(t){console.warn("Error initializing API monitoring storage:",t)}}getStoredData(){try{const t=localStorage.getItem(this.storageKey);return t?JSON.parse(t):{daily:{},hourly:{},lastCleanup:Date.now()}}catch(t){return console.warn("Error reading API monitoring data:",t),{daily:{},hourly:{},lastCleanup:Date.now()}}}saveData(t){try{localStorage.setItem(this.storageKey,JSON.stringify(t))}catch(a){console.warn("Error saving API monitoring data:",a)}}cleanupOldData(){const t=this.getStoredData(),a=Date.now(),r=a-24*60*60*1e3,o=a-7*24*60*60*1e3;Object.keys(t.daily).forEach(l=>{parseInt(l)<o&&delete t.daily[l]}),Object.keys(t.hourly).forEach(l=>{parseInt(l)<r&&delete t.hourly[l]}),t.lastCleanup=a,this.saveData(t)}recordApiCall(t,a,r=!0,o=null,l=0){const n=this.getStoredData(),c=Date.now(),i=new Date().toISOString().split("T")[0],d=Math.floor(c/(60*60*1e3))*(60*60*1e3);c-n.lastCleanup>60*60*1e3&&this.cleanupOldData(),n.daily[i]||(n.daily[i]={}),n.daily[i][t]||(n.daily[i][t]={total:0,success:0,errors:0,totalCost:0,avgResponseTime:0,endpoints:{}}),n.hourly[d]||(n.hourly[d]={}),n.hourly[d][t]||(n.hourly[d][t]={total:0,success:0,errors:0,totalCost:0,endpoints:{}});const u=n.daily[i][t];if(u.total++,r?u.success++:u.errors++,u.totalCost+=l,o!==null){const P=u.avgResponseTime*(u.total-1)+o;u.avgResponseTime=P/u.total}u.endpoints[a]||(u.endpoints[a]={total:0,success:0,errors:0}),u.endpoints[a].total++,r?u.endpoints[a].success++:u.endpoints[a].errors++;const x=n.hourly[d][t];x.total++,r?x.success++:x.errors++,x.totalCost+=l,x.endpoints[a]||(x.endpoints[a]={total:0,success:0,errors:0}),x.endpoints[a].total++,r?x.endpoints[a].success++:x.endpoints[a].errors++,this.saveData(n)}getTodayStats(){const t=this.getStoredData(),a=new Date().toISOString().split("T")[0];return t.daily[a]||{}}getCurrentHourStats(){const t=this.getStoredData(),a=Math.floor(Date.now()/(60*60*1e3))*(60*60*1e3);return t.hourly[a]||{}}getWeeklyStats(){const t=this.getStoredData(),a={},o=Date.now()-7*24*60*60*1e3;return Object.keys(t.daily).forEach(l=>{new Date(l).getTime()>=o&&Object.keys(t.daily[l]).forEach(c=>{a[c]||(a[c]={total:0,success:0,errors:0,totalCost:0,days:0});const i=t.daily[l][c];a[c].total+=i.total,a[c].success+=i.success,a[c].errors+=i.errors,a[c].totalCost+=i.totalCost,a[c].days++})}),a}getServiceCosts(){return{"google-pollen":{perRequest:.001,name:"Google Pollen API"},"google-maps":{perRequest:.005,name:"Google Maps API"},"google-geolocation":{perRequest:.005,name:"Google Geolocation API"},"google-weather":{perRequest:.001,name:"Google Weather API"}}}estimateMonthlyCost(){const t=this.getWeeklyStats(),a=this.getServiceCosts();let r=0;return Object.keys(t).forEach(o=>{var d;const l=t[o],c=l.total/Math.max(l.days,1)*30,i=((d=a[o])==null?void 0:d.perRequest)||0;r+=c*i}),{totalMonthlyCost:r,breakdown:Object.keys(t).map(o=>{var u,x;const l=t[o],n=l.total/Math.max(l.days,1),c=n*30,i=((u=a[o])==null?void 0:u.perRequest)||0,d=c*i;return{service:o,serviceName:((x=a[o])==null?void 0:x.name)||o,avgDailyRequests:Math.round(n*100)/100,monthlyRequests:Math.round(c),costPerRequest:i,monthlyCost:Math.round(d*100)/100}})}}getRecentErrors(t=24){const a=this.getStoredData(),r=[],o=Date.now()-t*60*60*1e3;return Object.keys(a.hourly).forEach(l=>{const n=parseInt(l);n>=o&&Object.keys(a.hourly[l]).forEach(c=>{const i=a.hourly[l][l];i&&i.errors>0&&r.push({timestamp:n,service:c,errors:i.errors,total:i.total,errorRate:(i.errors/i.total*100).toFixed(1)})})}),r.sort((l,n)=>n.timestamp-l.timestamp)}exportData(){const t=this.getStoredData(),a=this.getTodayStats(),r=this.getWeeklyStats(),o=this.estimateMonthlyCost();return{exportDate:new Date().toISOString(),rawData:t,summary:{today:a,weekly:r,monthlyCostEstimate:o}}}clearAllData(){try{return localStorage.removeItem(this.storageKey),this.initializeStorage(),!0}catch(t){return console.error("Error clearing API monitoring data:",t),!1}}}const U=new Ia;class _a{constructor(){this.apiKey="AIzaSyB_Fj3F0vAmvCNBGMGIN90fQtk85cuxj1s",this.baseUrl="https://maps.googleapis.com/maps/api",this.isLoaded=!1,this.loadPromise=null}async loadGoogleMaps(){return this.isLoaded?window.google:this.loadPromise?this.loadPromise:(this.loadPromise=new Promise((t,a)=>{if(window.google&&window.google.maps){this.isLoaded=!0,t(window.google);return}const r=document.createElement("script");r.src=`https://maps.googleapis.com/maps/api/js?key=${this.apiKey}&libraries=places,geometry`,r.async=!0,r.defer=!0,r.onload=()=>{this.isLoaded=!0,t(window.google)},r.onerror=()=>{a(new Error("Failed to load Google Maps API"))},document.head.appendChild(r)}),this.loadPromise)}async geocodeAddress(t){const a=Date.now();try{const r=await fetch(`${this.baseUrl}/geocode/json?address=${encodeURIComponent(t)}&key=${this.apiKey}`),o=Date.now()-a;if(!r.ok)throw U.recordApiCall("google-maps","geocoding",!1,o,.005),new Error(`Geocoding failed: ${r.status}`);const l=await r.json();if(l.status!=="OK"||!l.results.length)throw U.recordApiCall("google-maps","geocoding",!1,o,.005),new Error(`No results found for: ${t}`);U.recordApiCall("google-maps","geocoding",!0,o,.005);const n=l.results[0],c=n.geometry.location;return{latitude:c.lat,longitude:c.lng,address:n.formatted_address,components:n.address_components,placeId:n.place_id,source:"geocoding"}}catch(r){throw console.error("Geocoding error:",r),r}}async reverseGeocode(t,a){const r=Date.now();try{const o=await fetch(`${this.baseUrl}/geocode/json?latlng=${t},${a}&key=${this.apiKey}`),l=Date.now()-r;if(!o.ok)throw U.recordApiCall("google-maps","reverse_geocoding",!1,l,.005),new Error(`Reverse geocoding failed: ${o.status}`);const n=await o.json();if(n.status!=="OK"||!n.results.length)throw U.recordApiCall("google-maps","reverse_geocoding",!1,l,.005),new Error("No address found for coordinates");U.recordApiCall("google-maps","reverse_geocoding",!0,l,.005);const c=n.results[0];return{latitude:t,longitude:a,address:c.formatted_address,components:c.address_components,placeId:c.place_id,source:"reverse_geocoding"}}catch(o){throw console.error("Reverse geocoding error:",o),o}}async geocodeZipCode(t){const a=`${t}, USA`;try{const r=await this.geocodeAddress(a);if(!r.components.some(l=>l.types.includes("postal_code")))throw new Error("Invalid ZIP code");return{...r,zipCode:t,source:"zip_code"}}catch(r){throw console.error("ZIP code geocoding error:",r),new Error(`Invalid ZIP code: ${t}`)}}async searchPlaces(t,a=null,r=5e4){try{let o=`${this.baseUrl}/place/textsearch/json?query=${encodeURIComponent(t)}&key=${this.apiKey}`;a&&(o+=`&location=${a.latitude},${a.longitude}&radius=${r}`);const l=await fetch(o);if(!l.ok)throw new Error(`Places search failed: ${l.status}`);const n=await l.json();if(n.status!=="OK")throw new Error(`Places API error: ${n.status}`);return n.results.map(c=>({placeId:c.place_id,name:c.name,address:c.formatted_address,latitude:c.geometry.location.lat,longitude:c.geometry.location.lng,rating:c.rating,types:c.types}))}catch(o){throw console.error("Places search error:",o),o}}async createMap(t,a={}){await this.loadGoogleMaps();const o={...{zoom:10,center:{lat:40.7128,lng:-74.006},mapTypeId:"roadmap",zoomControl:!0,streetViewControl:!1,fullscreenControl:!1,mapTypeControl:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]},...a};return new window.google.maps.Map(t,o)}createMarker(t,a,r={}){const o={position:a,map:t,animation:window.google.maps.Animation.DROP};return new window.google.maps.Marker({...o,...r})}createInfoWindow(t,a={}){return new window.google.maps.InfoWindow({content:t,...a})}calculateDistance(t,a){const o=this.toRadians(a.latitude-t.latitude),l=this.toRadians(a.longitude-t.longitude),n=Math.sin(o/2)*Math.sin(o/2)+Math.cos(this.toRadians(t.latitude))*Math.cos(this.toRadians(a.latitude))*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))}toRadians(t){return t*(Math.PI/180)}async getCurrentLocation(t={}){return new Promise((a,r)=>{if(!navigator.geolocation){r(new Error("Geolocation not supported"));return}const o={enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5};navigator.geolocation.getCurrentPosition(async l=>{try{const{latitude:n,longitude:c,accuracy:i}=l.coords,d=await this.reverseGeocode(n,c);a({...d,accuracy:i,source:"gps"})}catch{a({latitude:l.coords.latitude,longitude:l.coords.longitude,accuracy:l.coords.accuracy,address:`${l.coords.latitude.toFixed(4)}, ${l.coords.longitude.toFixed(4)}`,source:"gps"})}},l=>{let n="Location access failed";switch(l.code){case l.PERMISSION_DENIED:n="Location access denied by user";break;case l.POSITION_UNAVAILABLE:n="Location information unavailable";break;case l.TIMEOUT:n="Location request timed out";break}r(new Error(n))},{...o,...t})})}isConfigured(){return!!this.apiKey}getFallbackLocation(t){const r={10001:{lat:40.7505,lng:-73.9934,address:"New York, NY 10001"},11218:{lat:40.6441,lng:-73.971,address:"Brooklyn, NY 11218"},90210:{lat:34.0901,lng:-118.4065,address:"Beverly Hills, CA 90210"},60601:{lat:41.8827,lng:-87.6233,address:"Chicago, IL 60601"},94102:{lat:37.7849,lng:-122.4094,address:"San Francisco, CA 94102"}}[t];if(r)return{latitude:r.lat,longitude:r.lng,address:r.address,zipCode:t,source:"fallback"};throw new Error(`Unsupported ZIP code: ${t}`)}}const F=new _a,Ut="AIzaSyB_Fj3F0vAmvCNBGMGIN90fQtk85cuxj1s",Wt="https://www.googleapis.com/geolocation/v1/geolocate",Ke=async()=>{const s=Date.now();try{const t=await fetch(`${Wt}?key=${Ut}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({considerIp:!0,wifiAccessPoints:[],cellTowers:[]})}),a=Date.now()-s;if(!t.ok)throw U.recordApiCall("google-geolocation","location",!1,a,.005),t.status===403?new Error("Google Geolocation API access denied. Check your API key and billing."):t.status===400?new Error("Invalid geolocation request"):new Error(`Geolocation API error: ${t.status}`);const r=await t.json();if(!r.location)throw U.recordApiCall("google-geolocation","location",!1,a,.005),new Error("No location data received");return U.recordApiCall("google-geolocation","location",!0,a,.005),{latitude:r.location.lat,longitude:r.location.lng,accuracy:r.accuracy||1e3,source:"google_geolocation",timestamp:new Date().toISOString()}}catch(t){throw console.error("Google Geolocation API error:",t),t}},zt=()=>!0,Ht=async()=>{let s=[];try{const t=await fetch(`${Wt}?key=${Ut}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({considerIp:!0,wifiAccessPoints:s,cellTowers:[]})});if(!t.ok)throw new Error(`Enhanced geolocation failed: ${t.status}`);const a=await t.json();return{latitude:a.location.lat,longitude:a.location.lng,accuracy:a.accuracy||1e3,source:"google_geolocation_enhanced",timestamp:new Date().toISOString(),enhancedData:{wifiPointsUsed:s.length,cellTowersUsed:0}}}catch(t){return console.error("Enhanced geolocation error:",t),Ke()}},ge={getCurrentLocation:Ke,getEnhancedLocation:Ht,isConfigured:zt},Ma=Object.freeze(Object.defineProperty({__proto__:null,default:ge,getCurrentLocation:Ke,getEnhancedLocation:Ht,isConfigured:zt},Symbol.toStringTag,{value:"Module"})),Bt=m.createContext({});function ne(){const s=m.useContext(Bt);if(!s)throw new Error("useLocation must be used within a LocationProvider");return s}function Ea({children:s}){const[t,a]=m.useState(null),[r,o]=m.useState(null),[l,n]=m.useState(!1),[c,i]=m.useState("prompt"),[d,u]=m.useState(null),[x,P]=m.useState(!1),[S,g]=m.useState(null),[y,w]=m.useState(0),j=5*60*1e3,p=100,N=10;m.useEffect(()=>{h(),b(),f(),k()},[]);const h=async()=>{if(navigator.permissions&&navigator.permissions.query)try{const M=await navigator.permissions.query({name:"geolocation"});i(M.state),M.addEventListener("change",()=>{i(M.state)})}catch(M){console.warn("Permission API not supported:",M)}},b=()=>{try{const M=localStorage.getItem("crowdpollen_location");if(M){const T=JSON.parse(M),L=60*60*1e3;Date.now()-T.timestamp<L?a(T):localStorage.removeItem("crowdpollen_location")}}catch(M){console.warn("Error loading saved location:",M),localStorage.removeItem("crowdpollen_location")}},f=()=>{try{const M=localStorage.getItem("crowdpollen_use_google_geolocation");M&&P(JSON.parse(M))}catch(M){console.warn("Error loading geolocation preference:",M)}},k=()=>{try{const M=localStorage.getItem("crowdpollen_api_call_history");if(M){const T=JSON.parse(M),L=60*60*1e3,O=T.filter(z=>Date.now()-z<L);w(O.length),g(O.length>0?Math.max(...O):null),O.length!==T.length&&localStorage.setItem("crowdpollen_api_call_history",JSON.stringify(O))}}catch(M){console.warn("Error loading API call history:",M)}},I=()=>{const M=Date.now();g(M),w(T=>T+1);try{const T=localStorage.getItem("crowdpollen_api_call_history"),L=T?JSON.parse(T):[],O=60*60*1e3,z=L.filter(K=>M-K<O);z.push(M),localStorage.setItem("crowdpollen_api_call_history",JSON.stringify(z))}catch(T){console.warn("Error saving API call history:",T)}},v=()=>{const M=Date.now();return S&&M-S<j?{allowed:!1,reason:`Please wait ${Math.ceil((j-(M-S))/1e3/60)} more minutes before requesting location again.`}:y>=N?{allowed:!1,reason:`Maximum ${N} location requests per hour reached. Please try again later.`}:{allowed:!0}},A=(M,T,L,O)=>{const K=M*Math.PI/180,le=L*Math.PI/180,X=(L-M)*Math.PI/180,B=(O-T)*Math.PI/180,J=Math.sin(X/2)*Math.sin(X/2)+Math.cos(K)*Math.cos(le)*Math.sin(B/2)*Math.sin(B/2);return 6371e3*(2*Math.atan2(Math.sqrt(J),Math.sqrt(1-J)))},C=(M,T)=>t?A(t.latitude,t.longitude,M,T)>p:!0,E=m.useCallback(M=>{P(M);try{localStorage.setItem("crowdpollen_use_google_geolocation",JSON.stringify(M))}catch(T){console.warn("Error saving geolocation preference:",T)}},[]),_=m.useCallback(async()=>{n(!0),o(null);try{if(!ge.isConfigured())throw new Error("Google Geolocation API not configured");const M=await ge.getCurrentLocation();let T=`${M.latitude.toFixed(4)}, ${M.longitude.toFixed(4)}`;if(F.isConfigured())try{T=(await F.reverseGeocode(M.latitude,M.longitude)).address}catch(O){console.warn("Reverse geocoding failed:",O)}const L={...M,address:T,source:"google_geolocation",timestamp:Date.now()};return a(L),D(L),L}catch(M){const T=M.message||"Google Geolocation failed";throw o(T),new Error(T)}finally{n(!1)}},[]),D=M=>{try{const T={...M,timestamp:Date.now()};localStorage.setItem("crowdpollen_location",JSON.stringify(T))}catch(T){console.warn("Error saving location:",T)}},R=m.useCallback(async(M={})=>{n(!0),o(null);try{const T=await new Promise((B,J)=>{if(!navigator.geolocation){J(new Error("Geolocation is not supported by your browser"));return}navigator.geolocation.getCurrentPosition(B,J,{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5,...M})}),{latitude:L,longitude:O,accuracy:z}=T.coords;if(t&&!C(L,O))return console.log("Location unchanged, using cached location"),n(!1),t;let K=`${L.toFixed(4)}, ${O.toFixed(4)}`,le=F.isConfigured();if(x&&ge.isConfigured()&&le){const B=v();if(!B.allowed)console.warn("Rate limit exceeded:",B.reason),le=!1;else try{I(),K=(await F.reverseGeocode(L,O)).address}catch(J){console.warn("Reverse geocoding failed:",J)}}else if(le)try{K=(await F.reverseGeocode(L,O)).address}catch(B){console.warn("Reverse geocoding failed:",B)}const X={latitude:L,longitude:O,accuracy:z,address:K,source:"gps",timestamp:Date.now()};return a(X),D(X),i("granted"),X}catch(T){const L=ft(T);throw o(L),T.message.includes("denied")&&i("denied"),new Error(L)}finally{n(!1)}},[t,x,C,v,I]),G=m.useCallback((M={})=>{if(!navigator.geolocation)return o("Geolocation is not supported"),null;const T={enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4,...M},L=navigator.geolocation.watchPosition(async O=>{try{const{latitude:z,longitude:K,accuracy:le}=O.coords;let X=`${z.toFixed(4)}, ${K.toFixed(4)}`;if(F.isConfigured())try{X=(await F.reverseGeocode(z,K)).address}catch(J){console.warn("Reverse geocoding failed:",J)}const B={latitude:z,longitude:K,accuracy:le,address:X,source:"gps",timestamp:Date.now()};a(B),D(B),o(null)}catch(z){console.error("Watch position error:",z)}},O=>{const z=ft(O);o(z)},T);return u(L),L},[]),te=m.useCallback(()=>{d&&navigator.geolocation&&(navigator.geolocation.clearWatch(d),u(null))},[d]),se=m.useCallback(async M=>{n(!0),o(null);try{if(!/^\d{5}(-\d{4})?$/.test(M))throw new Error("Invalid ZIP code format");const T=M.slice(0,5);let L;F.isConfigured()?L=await F.geocodeZipCode(T):L=F.getFallbackLocation(T);const O={...L,zipCode:T,source:"zip_code",timestamp:Date.now()};return a(O),D(O),O}catch(T){const L=T.message||"Invalid ZIP code";throw o(L),new Error(L)}finally{n(!1)}},[]),Q=m.useCallback(async M=>{n(!0),o(null);try{if(!F.isConfigured())throw new Error("Location search requires Google Maps API configuration");const L={...await F.geocodeAddress(M),source:"manual",timestamp:Date.now()};return a(L),D(L),L}catch(T){const L=T.message||"Unable to find location";throw o(L),new Error(L)}finally{n(!1)}},[]),Re=m.useCallback(()=>{a(null),o(null),localStorage.removeItem("crowdpollen_location"),te()},[te]),tt=m.useCallback(async()=>{if(t){if(t.source==="gps")return await R();if(t.source==="google_geolocation")return await _();if(t.zipCode)return await se(t.zipCode);if(t.address&&t.source==="manual")return await Q(t.address)}},[t,R,_,se,Q]),Oe=m.useCallback(async(M={})=>{if(x&&ge.isConfigured())try{return await _()}catch(T){return console.warn("Google Geolocation failed, falling back to GPS:",T),await R(M)}else return await R(M)},[x,_,R]),ts={location:t,error:r,isLoading:l,permissionStatus:c,requestGPSLocation:R,requestGoogleGeolocation:_,requestLocationWithPreference:Oe,watchPosition:G,stopWatching:te,setZipCode:se,setManualLocation:Q,clearLocation:Re,refreshLocation:tt,hasLocation:!!t,isGPSLocation:(t==null?void 0:t.source)==="gps",isGoogleGeolocation:(t==null?void 0:t.source)==="google_geolocation",isManualLocation:(t==null?void 0:t.source)==="manual",isGoogleMapsConfigured:F.isConfigured(),isGoogleGeolocationConfigured:ge.isConfigured(),useGoogleGeolocation:x,updateGeolocationPreference:E};return e.jsx(Bt.Provider,{value:ts,children:s})}function ft(s){if(typeof s=="string")return s;if(s.code)switch(s.code){case 1:return"Location access denied. Please enable location services.";case 2:return"Location information unavailable. Please try again.";case 3:return"Location request timed out. Please try again.";default:return"Unable to get location. Please try again."}return s.message||"Unable to get location. Please try again."}const qt=m.createContext({});function Vt(){const s=m.useContext(qt);if(!s)throw new Error("useNotification must be used within a NotificationProvider");return s}function Ta({children:s}){const[t,a]=m.useState([]),[r,o]=m.useState({highPollenAlerts:!0,symptomReminders:!0,weeklyReports:!1,pushNotifications:!0});m.useEffect(()=>{const g=localStorage.getItem("notification_preferences");if(g)try{o(JSON.parse(g))}catch(y){console.error("Failed to load notification preferences:",y)}},[]);const l=m.useCallback(g=>{o(y=>{const w={...y,...g};return localStorage.setItem("notification_preferences",JSON.stringify(w)),w})},[]),n=m.useCallback(g=>{const y=Date.now()+Math.random(),w={id:y,type:"info",duration:5e3,...g};return a(j=>[...j,w]),w.duration>0&&setTimeout(()=>{c(y)},w.duration),y},[]),c=m.useCallback(g=>{a(y=>y.filter(w=>w.id!==g))},[]),i=m.useCallback(()=>{a([])},[]),d=m.useCallback((g,y={})=>n({type:"success",message:g,...y}),[n]),u=m.useCallback((g,y={})=>n({type:"error",message:g,duration:8e3,...y}),[n]),x=m.useCallback((g,y={})=>n({type:"warning",message:g,...y}),[n]),P=m.useCallback((g,y={})=>n({type:"info",message:g,...y}),[n]),S={notifications:t,addNotification:n,removeNotification:c,clearAllNotifications:i,showSuccess:d,showError:u,showWarning:x,showInfo:P,preferences:r,updatePreferences:l};return e.jsxs(qt.Provider,{value:S,children:[s,e.jsx(La,{})]})}function La(){const{notifications:s,removeNotification:t}=Vt();return s.length===0?null:e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 space-y-2 max-w-sm w-full px-4",children:s.map(a=>e.jsx(Da,{notification:a,onRemove:()=>t(a.id)},a.id))})}function Da({notification:s,onRemove:t}){const{type:a,message:r,title:o,action:l}=s,n=()=>{const i="relative p-4 rounded-lg shadow-lg border-l-4 bg-white";switch(a){case"success":return`${i} border-green-500`;case"error":return`${i} border-red-500`;case"warning":return`${i} border-yellow-500`;case"info":default:return`${i} border-blue-500`}},c=()=>{switch(a){case"success":return e.jsx("svg",{className:"w-5 h-5 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})});case"error":return e.jsx("svg",{className:"w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})});case"warning":return e.jsx("svg",{className:"w-5 h-5 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})});case"info":default:return e.jsx("svg",{className:"w-5 h-5 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}};return e.jsxs("div",{className:`${n()} notification animate-slideDown`,children:[e.jsx("button",{onClick:t,className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close notification",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mr-3 mt-0.5",children:c()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[o&&e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:o}),e.jsx("p",{className:"text-sm text-gray-700",children:r}),l&&e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:l.onClick,className:"text-sm font-medium text-blue-600 hover:text-blue-500 transition-colors",children:l.label})})]})]})]})}function Ra(){const s=oe(),t=De(),a=[{id:"home",path:"/",icon:Ie,label:"Home"},{id:"camera",path:"/camera",icon:ee,label:"Submit"},{id:"map",path:"/map",icon:Me,label:"Map"},{id:"symptomLog",path:"/symptoms",icon:ns,label:"Log"}],r=o=>o==="/"?t.pathname==="/":t.pathname.startsWith(o);return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-gray-100 z-50 safe-area-bottom",children:e.jsx("div",{className:"max-w-mobile mx-auto",children:e.jsx("div",{className:"grid grid-cols-4 gap-4 px-6 py-2",children:a.map(o=>e.jsxs("button",{onClick:()=>s(o.path),className:`flex flex-col items-center justify-center py-3 px-2 transition-colors ${r(o.path)?"text-blue-500":"text-gray-500"}`,children:[e.jsx(o.icon,{className:`w-6 h-6 mb-1 ${r(o.path)?"stroke-2":"stroke-1.5"}`}),e.jsx("span",{className:`text-xs ${r(o.path)?"font-semibold":"font-medium"}`,children:o.label})]},o.id))})})})}class he{constructor(){this.apiUrl="https://alie354-crowdpollen.hf.space/api/analyze",this.infoUrl="https://alie354-crowdpollen.hf.space/api/info",this.healthUrl="https://alie354-crowdpollen.hf.space/health",this.defaultConfidence=.25,this.token="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",this.token||console.warn("⚠️ VITE_HUGGINGFACE_TOKEN not found in environment variables")}getHeaders(){return{"Content-Type":"application/json"}}fileToBase64(t){return new Promise((a,r)=>{const o=new FileReader;o.readAsDataURL(t),o.onload=()=>{const l=o.result.split(",")[1];a(l)},o.onerror=l=>r(l)})}async analyzePollen(t,a=this.defaultConfidence){const r=performance.now();try{console.log("🔄 Starting pollen analysis with Hugging Face API"),console.log(`📊 Image size: ${t.size} bytes, type: ${t.type}`),console.log(`🎯 Confidence threshold: ${a}`);const o=await this.fileToBase64(t);console.log("✅ Image converted to base64",`(${o.length} chars)`);const l={image_data:`data:image/jpeg;base64,${o}`,confidence_threshold:a};console.log("📤 Sending request to:",this.apiUrl);const n=await fetch(this.apiUrl,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(l)}),c=performance.now(),i=Math.round(c-r);if(console.log(`📥 Response received in ${i}ms, status: ${n.status}`),!n.ok){const u=await n.text();throw console.error(`❌ API Error ${n.status}:`,u),n.status===404?new Error("API endpoint not found (404). Check if your Hugging Face space is running and endpoints are available."):n.status===401?new Error("Authentication failed - check Hugging Face token"):n.status===403?new Error("Access forbidden - token may not have permission"):n.status===500?new Error("Internal server error - the model may be loading or crashed"):new Error(`HTTP ${n.status}: ${n.statusText}. Details: ${u}`)}const d=await n.json();if(console.log("✅ API response received:",d),console.log(`⏱️ Total processing time: ${i}ms`),d.success){const u=this.parseResults(d);return console.log("✅ Analysis completed successfully"),console.log(`🌼 Found ${u.totalPollenCount} pollen grains`),u}else throw new Error(d.error||"Analysis failed")}catch(o){const l=performance.now(),n=Math.round(l-r);return console.error(`❌ API analysis failed after ${n}ms:`,o.message),console.warn("🔄 Using fallback analysis instead"),this.generateFallbackAnalysis(t)}}async getModelInfo(){try{const t=await fetch(this.infoUrl,{headers:this.getHeaders()});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return await t.json()}catch(t){throw console.error("Failed to get model info:",t),t}}async checkHealth(){try{const t=await fetch(this.healthUrl,{headers:this.getHeaders()});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return await t.json()}catch(t){throw console.error("Health check failed:",t),t}}async validateToken(){try{return{valid:!0,health:await this.checkHealth(),message:"Token is valid and API is accessible"}}catch(t){return{valid:!1,error:t.message,needsToken:t.message.includes("Authentication")||t.message.includes("401"),message:`Token validation failed: ${t.message}`}}}parseResults(t){try{const[a,r,o]=t.data||[];if(!o)throw new Error("Invalid API response structure");return{totalPollenCount:o.total_pollen_count||0,densityLevel:this.normalizeDensityLevel(o.density_level),classBreakdown:o.class_breakdown||{},advice:o.advice||"No specific advice available",detections:o.detections||[],confidence:o.model_confidence_threshold||this.defaultConfidence,annotatedImage:a,summary:r,pollenTypes:this.extractPollenTypes(o.class_breakdown||{}),riskLevel:this.calculateRiskLevel(o.total_pollen_count||0),icon:this.getPollenIcon(o.density_level),color:this.getPollenColor(o.density_level),metadata:t.metadata||{},timestamp:new Date().toISOString()}}catch(a){throw console.error("Error parsing API results:",a),new Error("Failed to parse analysis results")}}normalizeDensityLevel(t){if(!t)return"None";const a=t.toLowerCase().trim();return{none:"None",low:"Low",moderate:"Moderate",medium:"Moderate",high:"High","very high":"Very High",very_high:"Very High"}[a]||t}extractPollenTypes(t){const a=[];for(const[r,o]of Object.entries(t))o>0&&a.push({name:r.replace(/^Pollen Type \d+$/,`Type ${r.split(" ").pop()}`),count:o,originalName:r});return a.sort((r,o)=>o.count-r.count)}calculateRiskLevel(t){return t===0?"None":t<=10?"Low":t<=30?"Moderate":t<=60?"High":"Very High"}getPollenIcon(t){return{None:"🌱",Low:"🟢",Moderate:"🟡",High:"🟠","Very High":"🔴"}[this.normalizeDensityLevel(t)]||"🟡"}getPollenColor(t){return{None:"#10b981",Low:"#22c55e",Moderate:"#f59e0b",High:"#ef4444","Very High":"#991b1b"}[this.normalizeDensityLevel(t)]||"#6b7280"}generateFallbackAnalysis(t){console.log("🔄 Generating fallback pollen analysis");const r=["Oak","Birch","Grass","Ragweed","Pine"].slice(0,Math.floor(Math.random()*3)+1),o=Math.floor(Math.random()*50)+10,l={};let n=o;r.forEach((i,d)=>{if(d===r.length-1)l[`Pollen Type ${d+1}`]=n;else{const u=Math.floor(Math.random()*(n/2))+1;l[`Pollen Type ${d+1}`]=u,n-=u}});for(let i=r.length+1;i<=5;i++)l[`Pollen Type ${i}`]=0;const c=this.calculateRiskLevel(o);return{totalPollenCount:o,densityLevel:c,classBreakdown:l,advice:`${c} pollen levels detected. ${o>30?"Consider taking precautions if sensitive to pollen.":"Generally safe conditions for outdoor activities."} (Demo mode - API unavailable)`,detections:r.map((i,d)=>({class:`Pollen Type ${d+1}`,confidence:(Math.random()*.3+.5).toFixed(2)})),confidence:this.defaultConfidence,annotatedImage:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=",summary:`🌼 **Found ${o} pollen grains** (Demo Mode)

${r.map((i,d)=>`• **${i}**: ${l[`Pollen Type ${d+1}`]} grains`).join(`
`)}

**Pollen Density**: ${c}
**Note**: API unavailable, showing demo results`,pollenTypes:this.extractPollenTypes(l),riskLevel:c,icon:this.getPollenIcon(c),color:this.getPollenColor(c),metadata:{demo:!0,reason:"API unavailable"},timestamp:new Date().toISOString()}}async testAllEndpoints(){console.log("🧪 Starting comprehensive API endpoint testing...");const t={endpoints:{},summary:{total:0,working:0,failed:0,responseTimes:[]},timestamp:new Date().toISOString()},a=[{name:"GET /api/info",url:this.infoUrl,method:"GET"},{name:"GET /health",url:this.healthUrl,method:"GET"},{name:"GET /docs",url:this.apiUrl.replace("/api/analyze","/docs"),method:"GET"},{name:"GET / (Gradio UI)",url:this.apiUrl.replace("/api/analyze",""),method:"GET"}];for(const r of a){t.summary.total++;const o=await this.testSingleEndpoint(r);t.endpoints[r.name]=o,o.success?(t.summary.working++,t.summary.responseTimes.push(o.responseTime)):t.summary.failed++,await new Promise(l=>setTimeout(l,200))}return t.summary.responseTimes.length>0&&(t.summary.avgResponseTime=Math.round(t.summary.responseTimes.reduce((r,o)=>r+o,0)/t.summary.responseTimes.length)),console.log("✅ Endpoint testing completed:",t),t}async testSingleEndpoint(t){const a=performance.now();try{console.log(`🔍 Testing ${t.name}...`);const r=await fetch(t.url,{method:t.method,headers:this.getHeaders()}),o=performance.now(),l=Math.round(o-a);if(r.ok){let n;const c=r.headers.get("content-type");if(c!=null&&c.includes("application/json"))n=await r.json();else{const i=await r.text();n=i.length>100?i.substring(0,100)+"...":i}return console.log(`✅ ${t.name} works! (${l}ms)`),{success:!0,status:r.status,responseTime:l,data:n,contentType:c||"unknown",message:`Success (${l}ms)`}}else return console.log(`❌ ${t.name} failed: HTTP ${r.status}`),{success:!1,status:r.status,responseTime:l,error:`HTTP ${r.status}: ${r.statusText}`,message:`Failed: HTTP ${r.status}`}}catch(r){const o=performance.now(),l=Math.round(o-a);return console.log(`❌ ${t.name} error:`,r.message),{success:!1,status:0,responseTime:l,error:r.message,message:`Error: ${r.message}`}}}async testConnection(){var t;try{console.log("🔄 Testing API connection...");const a=await this.testAllEndpoints(),r=document.createElement("canvas");r.width=1,r.height=1;const o=r.getContext("2d");o.fillStyle="white",o.fillRect(0,0,1,1);const l=await new Promise(i=>{r.toBlob(i,"image/jpeg",.8)});let n=null;if(a.summary.working>0)try{n=await this.analyzePollen(l,.1),console.log("✅ Test analysis completed:",n)}catch(i){console.warn("⚠️ Analysis test failed:",i.message)}const c=a.summary.working>=2;return{success:c,message:c?"API connection successful":"Some endpoints not working",endpoints:a,analysisTest:n?{success:!0,pollenCount:n.totalPollenCount,demo:((t=n.metadata)==null?void 0:t.demo)||!1}:{success:!1,error:"Analysis test failed"},recommendations:this.getConnectionRecommendations(a)}}catch(a){return console.error("❌ API connection test failed:",a),{success:!1,message:`API connection failed: ${a.message}`,error:a,recommendations:["Check if your Hugging Face space is running","Verify the space URL is correct","Ensure the space is public or you have proper authentication"]}}}getConnectionRecommendations(t){const a=[];return t.summary.working===0?(a.push("🚨 No endpoints are working - check if your Hugging Face space is running"),a.push("🔗 Verify the space URL: "+this.apiUrl.replace("/api/analyze","")),a.push("🔄 Try refreshing the space or restarting it")):t.summary.working<t.summary.total?(a.push("⚠️ Some endpoints are not working - this is normal for some spaces"),a.push("✅ Core functionality should still work")):(a.push("🎉 All endpoints are working perfectly!"),a.push("🚀 Your API is ready for pollen analysis")),t.summary.avgResponseTime>5e3&&(a.push("🐌 Response times are slow - the model may be loading"),a.push("⏳ Try again in a few minutes")),a}async getLocalPollenData(t,a){try{const r=new Date,o=r.getMonth();let l="Low",n="Mixed";o>=2&&o<=5?(l="High",n="Tree"):o>=6&&o<=8?(l="Moderate",n="Grass"):o>=9&&o<=10&&(l="Moderate",n="Weed");const c=Math.sin(t*Math.PI/180)*.3,i=Math.cos(a*Math.PI/180)*.2,d=(c+i)*20,u={Low:15,Moderate:35,High:65}[l]||25,x=Math.max(0,Math.round(u+d));return{location:{latitude:t,longitude:a,address:`${t.toFixed(4)}, ${a.toFixed(4)}`},current:{totalPollenCount:x,densityLevel:this.calculateRiskLevel(x),mainPollenType:n,lastUpdated:r.toISOString(),conditions:{temperature:Math.round(20+Math.random()*15),humidity:Math.round(40+Math.random()*40),windSpeed:Math.round(5+Math.random()*15)}},forecast:this.generateLocalForecast(t,a),advice:this.getSeasonalAdvice(o,x),icon:this.getPollenIcon(this.calculateRiskLevel(x)),color:this.getPollenColor(this.calculateRiskLevel(x))}}catch(r){throw console.error("Error fetching local pollen data:",r),r}}generateLocalForecast(t,a){const r=[],o=new Date;for(let l=1;l<=5;l++){const n=new Date(o);n.setDate(n.getDate()+l);const c=Math.random()*.4-.2,i=25+Math.sin(t*Math.PI/180)*15,d=Math.max(0,Math.round(i*(1+c)));r.push({date:n.toISOString().split("T")[0],totalPollenCount:d,densityLevel:this.calculateRiskLevel(d),mainType:this.getSeasonalMainType(n.getMonth()),conditions:{temperature:Math.round(18+Math.random()*20),humidity:Math.round(35+Math.random()*50),windSpeed:Math.round(3+Math.random()*20)}})}return r}getSeasonalMainType(t){return t>=2&&t<=5?"Tree":t>=6&&t<=8?"Grass":t>=9&&t<=10?"Weed":"Mixed"}getSeasonalAdvice(t,a){let r="";return t>=2&&t<=5?r="Spring tree pollen season is active. ":t>=6&&t<=8?r="Summer grass pollen season. ":t>=9&&t<=10?r="Fall weed pollen season. ":r="Winter season - generally lower pollen levels. ",a>50?r+="High pollen levels detected. Consider staying indoors during peak hours and taking allergy medication if needed.":a>25?r+="Moderate pollen levels. Sensitive individuals should take precautions.":r+="Low pollen levels. Good conditions for outdoor activities.",r}async getNationalPollenData(){try{return{nationalAverage:"Moderate",regions:[{name:"Northeast",level:"High",count:45},{name:"Southeast",level:"Very High",count:78},{name:"Midwest",level:"Moderate",count:32},{name:"Southwest",level:"Low",count:15},{name:"West",level:"Moderate",count:28}],lastUpdated:new Date().toISOString(),trend:"increasing"}}catch(t){throw console.error("Error fetching national pollen data:",t),t}}async submitPollenReading(t){try{const{image:a,location:r,user_id:o,timestamp:l}=t,n=await this.analyzePollen(a),c={id:`submission_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:l||new Date().toISOString(),location:{latitude:r==null?void 0:r.latitude,longitude:r==null?void 0:r.longitude,address:r==null?void 0:r.address},user_id:o||null,image_data:{size:a==null?void 0:a.size,type:a==null?void 0:a.type,lastModified:a==null?void 0:a.lastModified},analysis:n,pollen_count:n.totalPollenCount,pollen_density:this.mapDensityToLevel(n.densityLevel),confidence_score:n.confidence||.75,plant_species:this.extractSpeciesNames(n.pollenTypes),advice:n.advice,weather_conditions:this.generateWeatherContext(r)};this.storeSubmissionLocally(c);try{console.log("📡 Attempting to save submission to Supabase...");const i=await ye(()=>Promise.resolve().then(()=>ke),void 0);console.log("📦 Supabase module loaded:",i);const{saveSubmission:d}=i;console.log("📝 Calling saveSubmission...");const u={user_id:o||null,image_card_url:n.annotatedImage,latitude:r==null?void 0:r.latitude,longitude:r==null?void 0:r.longitude,zip_code:(r==null?void 0:r.zip_code)||null,address:(r==null?void 0:r.address)||null,pollen_density:this.mapDensityToLevel(n.densityLevel),pollen_count:n.totalPollenCount,confidence_score:n.confidence||.75,plant_species:this.extractSpeciesNames(n.pollenTypes),weather_data:c.weather_conditions,user_symptoms:null,notes:null,is_anonymous:!o};await d(u)}catch(i){console.warn("⚠️ Failed to save submission to Supabase:",(i==null?void 0:i.message)||i),i!=null&&i.response&&console.error("Supabase error response:",await i.response.text())}return c}catch(a){throw console.error("Error submitting pollen reading:",a),new Error(`Failed to submit pollen reading: ${a.message}`)}}mapDensityToLevel(t){return{Low:"low",Moderate:"moderate",High:"high","Very High":"very_high"}[t]||"moderate"}extractSpeciesNames(t){return!t||t.length===0?["Unknown Species"]:t.map(a=>({"Type 1":"Oak","Type 2":"Birch","Type 3":"Grass","Type 4":"Ragweed","Type 5":"Pine"})[a.name]||a.name||"Unknown")}generateWeatherContext(t){return{temperature:Math.round(15+Math.random()*20),humidity:Math.round(40+Math.random()*40),wind_speed:Math.round(5+Math.random()*15),conditions:["Clear","Partly Cloudy","Overcast"][Math.floor(Math.random()*3)]}}storeSubmissionLocally(t){try{const a=JSON.parse(localStorage.getItem("crowdpollen_submissions")||"[]"),r={...t,image_data:{...t.image_data,stored:!0}},l=a.slice(-30+1);l.push(r);try{localStorage.setItem("crowdpollen_submissions",JSON.stringify(l)),console.log("Submission stored locally:",t.id)}catch{console.warn("LocalStorage quota exceeded, clearing and storing only latest submission"),localStorage.setItem("crowdpollen_submissions",JSON.stringify([r]))}console.log("Submission stored locally:",t.id)}catch(a){console.warn("Failed to store submission locally:",a)}}getLocalSubmissions(){try{return JSON.parse(localStorage.getItem("crowdpollen_submissions")||"[]")}catch(t){return console.warn("Failed to retrieve local submissions:",t),[]}}getFormattedAdvice(t){const{totalPollenCount:a,densityLevel:r,pollenTypes:o}=t;let l=t.advice;if(a>30&&(l+=`

• Consider staying indoors during peak hours (10 AM - 4 PM)`,l+=`
• Keep windows closed and use air conditioning`),o.length>0){const n=o[0].name;l+=`
• Primary pollen type detected: ${n}`}return(r==="High"||r==="Very High")&&(l+=`
• Take allergy medication if prescribed`,l+=`
• Shower and change clothes after being outside`),l}}window.CrowdPollenAPI=he;window.crowdPollenAPI=new he;he.prototype.getLocalReportCounts=async function(s,t,a=null){try{const{supabase:r}=await ye(async()=>{const{supabase:c}=await Promise.resolve().then(()=>ke);return{supabase:c}},void 0);console.log("📍 Calling getLocalReportCounts with:",{latitude:s,longitude:t,zipCode:a});const{data:o,error:l}=await r.rpc("get_local_report_counts",{user_lat:s,user_lon:t,user_zip:a});if(l)throw l;const n={};for(const c of o)n[c.radius_label]=c.report_count;return console.log("📊 Local report counts received:",n),n}catch(r){return console.error("Error fetching local report counts:",r),{}}};he.prototype.getLocalSubmissions=async function(s,t,a=10){try{const{supabase:r}=await ye(async()=>{const{supabase:n}=await Promise.resolve().then(()=>ke);return{supabase:n}},void 0),{data:o,error:l}=await r.from("submissions").select("*").eq("flagged",!1).filter("latitude","gte",s-.1).filter("latitude","lte",s+.1).filter("longitude","gte",t-.1).filter("longitude","lte",t+.1).order("created_at",{ascending:!1}).limit(100);if(l)throw l;return o}catch(r){return console.error("Error fetching local submissions:",r),[]}};he.prototype.getNationalSubmissions=async function(){try{const{supabase:s}=await ye(async()=>{const{supabase:r}=await Promise.resolve().then(()=>ke);return{supabase:r}},void 0),{data:t,error:a}=await s.from("submissions").select("*").eq("flagged",!1).order("created_at",{ascending:!1}).limit(200);if(a)throw a;return t}catch(s){return console.error("Error fetching national submissions:",s),[]}};he.prototype.getRecentSubmissions=async function(s=10){try{const{supabase:t}=await ye(async()=>{const{supabase:o}=await Promise.resolve().then(()=>ke);return{supabase:o}},void 0),{data:a,error:r}=await t.from("submissions").select("*").eq("flagged",!1).order("created_at",{ascending:!1}).limit(s);if(r)throw r;return a}catch(t){return console.error("Error fetching recent submissions:",t),[]}};const q=new he,Yt="https://pollen.googleapis.com/v1",Kt="AIzaSyB_Fj3F0vAmvCNBGMGIN90fQtk85cuxj1s",Je=6*60*60*1e3,de=new Map,Jt=(s,t,a)=>{const r=Math.round(s*1e3)/1e3,o=Math.round(t*1e3)/1e3;return`forecast_${r}_${o}_${a}`},Ze=s=>s&&Date.now()-s.timestamp<Je,Oa=async(s,t={},a=3)=>{const r={method:"GET",headers:{"Content-Type":"application/json",...t.headers},...t},o=Date.now();let l=null;for(let n=0;n<a;n++)try{const c=new AbortController,i=setTimeout(()=>c.abort(),1e4),d=await fetch(s,{...r,signal:c.signal});clearTimeout(i);const u=Date.now()-o;if(!d.ok){if(U.recordApiCall("google-pollen","forecast",!1,u,.001),d.status===429){const x=Math.pow(2,n)*1e3;await new Promise(P=>setTimeout(P,x));continue}throw d.status===403?new Error("Google Pollen API access denied. Check your API key and billing."):d.status===404?new Error("No pollen data available for this location"):new Error(`API request failed: ${d.status} ${d.statusText}`)}return U.recordApiCall("google-pollen","forecast",!0,u,.001),await d.json()}catch(c){if(l=c,c.name==="AbortError"&&(l=new Error("Request timeout - Google Pollen API not responding")),n===a-1){const d=Date.now()-o;throw U.recordApiCall("google-pollen","forecast",!1,d,.001),l}const i=c.name==="AbortError"?1e3:Math.pow(2,n)*1e3;await new Promise(d=>setTimeout(d,i))}},Zt=async(s,t,a=3,r="en")=>{if(!s||!t)throw new Error("Latitude and longitude are required");if(a<1||a>5)throw new Error("Days must be between 1 and 5");const o=Jt(s,t,a),l=de.get(o);if(Ze(l))return console.log("Returning cached forecast data"),l.data;try{const n=new URL(`${Yt}/forecast:lookup`);n.searchParams.append("key",Kt),n.searchParams.append("location.latitude",s.toString()),n.searchParams.append("location.longitude",t.toString()),n.searchParams.append("days",a.toString()),n.searchParams.append("languageCode",r),console.log("Fetching forecast from Google Pollen API:",{latitude:s,longitude:t,days:a}),console.log("API URL:",n.toString());const c=await Oa(n.toString());console.log("Google Pollen API response received:",c);const i=Fa(c);return de.set(o,{data:i,timestamp:Date.now()}),i}catch(n){return console.error("Failed to fetch pollen forecast:",n),console.log("Returning mock data as fallback"),Ba(s,t,a)}},Fa=s=>{if(console.log("Processing raw Google Pollen data:",s),!s||!s.dailyInfo)throw console.error("Invalid forecast data structure:",s),new Error("Invalid forecast data received");console.log("Daily info array:",s.dailyInfo);const t={regionCode:s.regionCode,dailyForecasts:s.dailyInfo.map((a,r)=>{var l,n,c,i,d,u,x,P,S,g,y,w,j,p,N,h,b,f,k,I,v,A,C,E;console.log(`Processing day ${r}:`,a);const o={date:a.date,pollenTypes:{tree:{index:((c=(n=(l=a.pollenTypeInfo)==null?void 0:l.find(_=>_.code==="TREE"))==null?void 0:n.indexInfo)==null?void 0:c.value)||0,category:((u=(d=(i=a.pollenTypeInfo)==null?void 0:i.find(_=>_.code==="TREE"))==null?void 0:d.indexInfo)==null?void 0:u.category)||"UNSPECIFIED",displayName:((P=(x=a.pollenTypeInfo)==null?void 0:x.find(_=>_.code==="TREE"))==null?void 0:P.displayName)||"Tree Pollen"},grass:{index:((y=(g=(S=a.pollenTypeInfo)==null?void 0:S.find(_=>_.code==="GRASS"))==null?void 0:g.indexInfo)==null?void 0:y.value)||0,category:((p=(j=(w=a.pollenTypeInfo)==null?void 0:w.find(_=>_.code==="GRASS"))==null?void 0:j.indexInfo)==null?void 0:p.category)||"UNSPECIFIED",displayName:((h=(N=a.pollenTypeInfo)==null?void 0:N.find(_=>_.code==="GRASS"))==null?void 0:h.displayName)||"Grass Pollen"},weed:{index:((k=(f=(b=a.pollenTypeInfo)==null?void 0:b.find(_=>_.code==="WEED"))==null?void 0:f.indexInfo)==null?void 0:k.value)||0,category:((A=(v=(I=a.pollenTypeInfo)==null?void 0:I.find(_=>_.code==="WEED"))==null?void 0:v.indexInfo)==null?void 0:A.category)||"UNSPECIFIED",displayName:((E=(C=a.pollenTypeInfo)==null?void 0:C.find(_=>_.code==="WEED"))==null?void 0:E.displayName)||"Weed Pollen"}},plantInfo:a.plantInfo||[],healthRecommendations:a.healthRecommendations||[]};return console.log(`Processed day ${r}:`,o),o}),metadata:{fetchedAt:new Date().toISOString(),source:"google_pollen_api",cacheExpiry:new Date(Date.now()+Je).toISOString()}};return console.log("Final processed data:",t),t},$a=(s,t,a,r)=>{const o=["TREE_UPI","GRASS_UPI","WEED_UPI"];if(!o.includes(s))throw new Error(`Invalid map type. Must be one of: ${o.join(", ")}`);const l=new URL(`${Yt}/mapTypes/${s}/heatmapTiles/${t}/${a}/${r}`);return l.searchParams.append("key",Kt),l.toString()},Ga=async()=>{try{return await Zt(40.7128,-74.006,1),!0}catch(s){return console.error("API key validation failed:",s),!1}},Ua=(s,t,a=3)=>{const r=Jt(s,t,a),o=de.get(r);return Ze(o)?o.data:null},Wa=()=>{de.clear(),console.log("Google Pollen API cache cleared")},za=()=>{let s=0,t=0;for(const[a,r]of de.entries())Ze(r)?s++:t++;return{totalEntries:de.size,validEntries:s,expiredEntries:t,cacheHitRate:s/Math.max(de.size,1)}},_e=(s,t=0)=>{const a=s==null?void 0:s.toString().toUpperCase(),r={UNSPECIFIED:"unknown",VERY_LOW:"very_low",LOW:"low",MODERATE:"moderate",HIGH:"high",VERY_HIGH:"very_high"};return a==="UNSPECIFIED"&&t>0?t<=1?"very_low":t<=2?"low":t<=3?"moderate":t<=4?"high":"very_high":r[a]||"unknown"},Ha=s=>{var i,d,u,x,P,S,g,y,w,j,p,N;const t=["very_low","low","moderate","high","very_high"],a={very_low:1,low:2,moderate:3,high:4,very_high:5,unknown:0},r=_e((i=s.tree)==null?void 0:i.category,(d=s.tree)==null?void 0:d.index),o=_e((u=s.grass)==null?void 0:u.category,(x=s.grass)==null?void 0:x.index),l=_e((P=s.weed)==null?void 0:P.category,(S=s.weed)==null?void 0:S.index);console.log("Overall pollen level calculation:",{tree:{category:(g=s.tree)==null?void 0:g.category,index:(y=s.tree)==null?void 0:y.index,level:r},grass:{category:(w=s.grass)==null?void 0:w.category,index:(j=s.grass)==null?void 0:j.index,level:o},weed:{category:(p=s.weed)==null?void 0:p.category,index:(N=s.weed)==null?void 0:N.index,level:l}});const n=Math.max(a[r]||0,a[o]||0,a[l]||0),c=t[n-1]||"unknown";return console.log("Final overall level:",c,"from max value:",n),c},Ba=(s,t,a)=>{const r=["VERY_LOW","LOW","MODERATE","HIGH","VERY_HIGH"],o=[];for(let l=0;l<a;l++){const n=new Date;n.setDate(n.getDate()+l);const c=n.getMonth();let i,d,u;c>=2&&c<=4?(i=r[3+Math.floor(Math.random()*2)],d=r[1+Math.floor(Math.random()*2)],u=r[Math.floor(Math.random()*2)]):c>=5&&c<=7?(i=r[Math.floor(Math.random()*3)],d=r[3+Math.floor(Math.random()*2)],u=r[1+Math.floor(Math.random()*2)]):c>=8&&c<=10?(i=r[Math.floor(Math.random()*2)],d=r[Math.floor(Math.random()*3)],u=r[3+Math.floor(Math.random()*2)]):(i=r[Math.floor(Math.random()*2)],d=r[Math.floor(Math.random()*2)],u=r[Math.floor(Math.random()*2)]),o.push({date:n.toISOString().split("T")[0],pollenTypes:{tree:{index:r.indexOf(i)+1,category:i,displayName:"Tree Pollen"},grass:{index:r.indexOf(d)+1,category:d,displayName:"Grass Pollen"},weed:{index:r.indexOf(u)+1,category:u,displayName:"Weed Pollen"}},plantInfo:[{displayName:"Oak",inSeason:c>=2&&c<=4},{displayName:"Birch",inSeason:c>=2&&c<=4},{displayName:"Timothy Grass",inSeason:c>=5&&c<=7},{displayName:"Ragweed",inSeason:c>=8&&c<=10}].filter(x=>x.inSeason),healthRecommendations:["Check pollen forecasts daily","Keep windows closed during high pollen days","Consider wearing sunglasses outdoors"]})}return{regionCode:"US",dailyForecasts:o,metadata:{fetchedAt:new Date().toISOString(),source:"mock_data",cacheExpiry:new Date(Date.now()+Je).toISOString()}}},qa=()=>!0,H={getForecast:Zt,getHeatmapTileUrl:$a,validateApiKey:Ga,getCachedForecast:Ua,clearCache:Wa,getCacheStats:za,convertCategoryToLevel:_e,getOverallPollenLevel:Ha,isConfigured:qa},ie={VALIDATED:"validated",VARIANCE:"variance",SIGNIFICANT_VARIANCE:"significant_variance",NO_DATA:"no_data",ERROR:"error"},Ae={google:.7,user:.3,recency:.2,accuracy:.15},Va=async(s,t=null)=>{try{if(!t&&s.latitude&&s.longitude)try{t=(await H.getForecast(s.latitude,s.longitude,1)).dailyForecasts[0]}catch(c){return console.warn("Could not fetch Google forecast for validation:",c),{status:ie.NO_DATA,variance:null,notes:"No Google forecast data available for this location",googleData:null}}if(!t)return{status:ie.NO_DATA,variance:null,notes:"No forecast data available",googleData:null};const a=re(s.pollen_level),r=Qe(t.pollenTypes),o=Ja(a,r);let l,n="";return o<=30?(l=ie.VALIDATED,n=`User report matches Google forecast (${o.toFixed(1)}% variance)`):o<=50?(l=ie.VARIANCE,n=`Moderate variance from Google forecast (${o.toFixed(1)}% difference)`):(l=ie.SIGNIFICANT_VARIANCE,n=`Significant variance from Google forecast (${o.toFixed(1)}% difference)`),{status:l,variance:o,notes:n,googleData:{overall_level:r,tree_level:re(H.convertCategoryToLevel(t.pollenTypes.tree.category)),grass_level:re(H.convertCategoryToLevel(t.pollenTypes.grass.category)),weed_level:re(H.convertCategoryToLevel(t.pollenTypes.weed.category)),forecast_date:t.date}}}catch(a){return console.error("Error validating submission:",a),{status:ie.ERROR,variance:null,notes:`Validation error: ${a.message}`,googleData:null}}},Qt=(s,t=[],a={})=>{const{radiusKm:r=10,maxAgeHours:o=24,minSubmissions:l=3}=a,n=Za(t,s.location||{},r,o);if(n.length<l)return{forecast:s,confidence:.85,dataSource:"google_primary",userDataInfluence:0,submissionCount:n.length,notes:"Forecast based primarily on Google data due to limited user submissions"};const c=Xa(n),i=er(s,c),d=tr(s,c,n.length);return{forecast:i,confidence:d,dataSource:"hybrid",userDataInfluence:sr(n.length,c.accuracy),submissionCount:n.length,notes:`Combined forecast using Google data and ${n.length} user submissions`}},Ya=async(s,t,a=3)=>{try{console.log("Data fusion: Starting enhanced forecast for:",{latitude:s,longitude:t,days:a});const r=await H.getForecast(s,t,a);console.log("Data fusion: Google forecast received:",r);const o=await q.getLocalPollenData(s,t,10);console.log("Data fusion: User submissions received:",o);const l=r.dailyForecasts.map(c=>{const i=Qa(o.submissions||[],c.date),d=Qt({...c,location:{latitude:s,longitude:t}},i);return{...c,combined:d.forecast,confidence:d.confidence,dataSource:d.dataSource,userDataInfluence:d.userDataInfluence,submissionCount:d.submissionCount}}),n={...r,dailyForecasts:l,metadata:{...r.metadata,enhanced:!0,fusionAlgorithm:"weighted_average_v1"}};return console.log("Data fusion: Final enhanced forecast:",n),n}catch(r){throw console.error("Error creating enhanced forecast:",r),r}},re=s=>({very_low:1,low:2,moderate:3,high:4,very_high:5,unknown:0})[s]||0,Ka=s=>{const t=["unknown","very_low","low","moderate","high","very_high"],a=Math.round(Math.max(0,Math.min(5,s)));return t[a]},Qe=s=>{const t=re(H.convertCategoryToLevel(s.tree.category)),a=re(H.convertCategoryToLevel(s.grass.category)),r=re(H.convertCategoryToLevel(s.weed.category));return Math.max(t,a,r)},Ja=(s,t)=>t===0?0:Math.abs(s-t)/t*100,Za=(s,t,a,r)=>{const o=new Date,l=r*60*60*1e3;return s.filter(n=>o-new Date(n.created_at)>l?!1:t.latitude&&t.longitude&&n.latitude&&n.longitude?ar(t.latitude,t.longitude,n.latitude,n.longitude)<=a:!0)},Qa=(s,t)=>{const a=new Date(t);return s.filter(r=>new Date(r.created_at).toDateString()===a.toDateString())},Xa=s=>{if(s.length===0)return{averageLevel:0,accuracy:0,recency:0};const t=s.map(i=>re(i.pollen_level)),a=t.reduce((i,d)=>i+d,0)/t.length,o=s.filter(i=>i.google_validation_status==="validated").length/s.length,l=Date.now(),n=s.map(i=>{const u=(l-new Date(i.created_at).getTime())/(1e3*60*60);return Math.max(0,1-u/24)}),c=n.reduce((i,d)=>i+d,0)/n.length;return{averageLevel:a,accuracy:o,recency:c}},er=(s,t)=>{const a=Qe(s.pollenTypes),r=t.averageLevel,o=Ae.google+(t.accuracy<.7?.1:0),l=Ae.user+t.accuracy*Ae.accuracy+t.recency*Ae.recency,n=o+l,c=o/n,i=l/n,d=a*c+r*i;return{...s,fusedLevel:Ka(d),weights:{google:c,user:i}}},tr=(s,t,a)=>{let r=.7;const o=Qe(s.pollenTypes),l=Math.abs(o-t.averageLevel)/Math.max(o,1);return l<.3?r+=.2:l<.5&&(r+=.1),r+=Math.min(.1,a*.02),r+=t.accuracy*.1,Math.min(.95,r)},sr=(s,t)=>{let a=Math.min(.4,s*.05);return a*=.5+t*.5,Math.round(a*100)},ar=(s,t,a,r)=>{const l=(a-s)*Math.PI/180,n=(r-t)*Math.PI/180,c=Math.sin(l/2)*Math.sin(l/2)+Math.cos(s*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},rr={validateSubmission:Va,createCombinedForecast:Qt,getEnhancedForecast:Ya,VALIDATION_STATUS:ie};function or(){var p,N,h,b;const{location:s}=ne(),[t,a]=m.useState(null),[r,o]=m.useState(!0),[l,n]=m.useState(null),[c,i]=m.useState(0);m.useEffect(()=>{console.log("ForecastWidget: State changed - forecast:",t,"loading:",r,"error:",l)},[t,r,l]),m.useEffect(()=>{d()},[s]);const d=async()=>{if(!(s!=null&&s.latitude)||!(s!=null&&s.longitude)){o(!1);return}try{o(!0),n(null),console.log("ForecastWidget: Starting forecast load for location:",s);const f="AIzaSyB_Fj3F0vAmvCNBGMGIN90fQtk85cuxj1s";if(console.log("ForecastWidget: Has Google API key:",!!f),f){console.log("ForecastWidget: Calling enhanced forecast...");const k=await rr.getEnhancedForecast(s.latitude,s.longitude,5);console.log("ForecastWidget: Enhanced forecast received:",k),a(k)}}catch(f){console.error("Failed to load forecast:",f);try{console.log("ForecastWidget: Trying fallback to Google-only forecast...");const k=await H.getForecast(s.latitude,s.longitude,5);console.log("ForecastWidget: Fallback forecast received:",k),a(k),n(null)}catch(k){console.error("Fallback forecast also failed:",k);const I=u(s);a(I),n("Demo data - API unavailable")}}finally{console.log("ForecastWidget: Setting loading to false"),o(!1)}},u=f=>{const k=[],I=["low","moderate","high","moderate","low"],v=["tree","grass","weed"];for(let A=0;A<5;A++){const C=new Date,E=C.getFullYear(),_=C.getMonth(),D=C.getDate(),R=new Date(E,_,D+A),G=I[A],te={};v.forEach(Q=>{const Re=Math.random()*.4-.2,Oe=Math.max(1,Math.min(5,Math.round((G==="low"?2:G==="moderate"?3:G==="high"?4:2)+Re)));te[Q]={category:G.toUpperCase(),index:Oe,displayName:Q.charAt(0).toUpperCase()+Q.slice(1)}});const se=`${R.getFullYear()}-${String(R.getMonth()+1).padStart(2,"0")}-${String(R.getDate()).padStart(2,"0")}`;k.push({date:se,pollenTypes:te,confidence:.85+Math.random()*.1,dataSource:"demo",submissionCount:Math.floor(Math.random()*20),userDataInfluence:Math.floor(Math.random()*30),healthRecommendations:[G==="high"?"Consider limiting outdoor time":"Good day for outdoor activities","Take allergy medication if needed","Keep windows closed during peak hours"]})}return{dailyForecasts:k,metadata:{enhanced:!1,fetchedAt:new Date().toISOString(),location:f.address||`${f.latitude}, ${f.longitude}`,source:"demo"}}},x=f=>{const k={very_low:{color:"#34C759",emoji:"🟢",description:"Very Low",advice:"Perfect day to be outside"},low:{color:"#34C759",emoji:"🟢",description:"Low",advice:"Great conditions for outdoor activities"},moderate:{color:"#FFCC00",emoji:"🟡",description:"Moderate",advice:"Good day for most activities"},high:{color:"#FF9500",emoji:"🟠",description:"High",advice:"Consider limiting outdoor time"},very_high:{color:"#FF3B30",emoji:"🔴",description:"Very High",advice:"Stay indoors if possible"},unknown:{color:"#E5E5E7",emoji:"⚪",description:"Out of Season",advice:"Not currently active"}};return k[f]||k.unknown},P=()=>{const f=new Date().getMonth();return f>=2&&f<=4?{season:"Spring",primary:"Tree",description:"Peak tree pollen season. Oak, birch, and maple are most active.",icon:"🌸"}:f>=5&&f<=7?{season:"Summer",primary:"Grass",description:"Peak grass pollen season. Timothy, bermuda, and ryegrass are most active.",icon:"🌾"}:f>=8&&f<=10?{season:"Fall",primary:"Weed",description:"Peak weed pollen season. Ragweed and other weeds are most active.",icon:"🍂"}:{season:"Winter",primary:"None",description:"Low pollen season. Most plants are dormant.",icon:"❄️"}},S=(f,k=!1)=>{let I;if(typeof f=="string")I=new Date(f+"T00:00:00");else if(typeof f=="object"&&f.year&&f.month&&f.day)I=new Date(f.year,f.month-1,f.day);else if(f instanceof Date)I=new Date(f);else return console.error("Invalid date format:",f),"Invalid Date";if(isNaN(I.getTime()))return console.error("Invalid date:",f),"Invalid Date";const v=new Date;v.setHours(0,0,0,0);const A=new Date(v);A.setDate(A.getDate()+1);const C=new Date(I);return C.setHours(0,0,0,0),C.getTime()===v.getTime()?"Today":C.getTime()===A.getTime()?"Tomorrow":k?I.toLocaleDateString("en-US",{weekday:"short"}):I.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})};if(!(s!=null&&s.latitude)||!(s!=null&&s.longitude))return console.log("ForecastWidget: Rendering location required UI"),e.jsx("div",{className:"bg-white rounded-xl p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Location Required"}),e.jsx("p",{className:"text-gray-600",children:"Set your location to see pollen forecast"})]})});if(r)return console.log("ForecastWidget: Rendering loading UI"),e.jsx("div",{className:"bg-white rounded-xl p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-32 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24 mb-6"}),e.jsx("div",{className:"h-16 bg-gray-200 rounded mb-6"}),e.jsx("div",{className:"flex space-x-4",children:[...Array(5)].map((f,k)=>e.jsx("div",{className:"flex-1 h-12 bg-gray-200 rounded"},k))})]})});if(l)return console.log("ForecastWidget: Rendering error UI with error:",l),e.jsx("div",{className:"bg-white rounded-xl p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(je,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Forecast Unavailable"}),e.jsx("p",{className:"text-gray-600 mb-4",children:l}),e.jsx("button",{onClick:d,className:"px-4 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors",children:"Try Again"})]})});if(!((p=t==null?void 0:t.dailyForecasts)!=null&&p.length))return console.log("ForecastWidget: Rendering no data UI - forecast:",t),e.jsx("div",{className:"bg-white rounded-xl p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Data Available"}),e.jsx("p",{className:"text-gray-600",children:"No forecast data for this location"})]})});const g=t.dailyForecasts[c],y=P();console.log("ForecastWidget: Selected forecast pollen types:",g.pollenTypes),console.log("ForecastWidget: Tree pollen data:",g.pollenTypes.tree),console.log("ForecastWidget: Grass pollen data:",g.pollenTypes.grass),console.log("ForecastWidget: Weed pollen data:",g.pollenTypes.weed);const w=H.getOverallPollenLevel(g.pollenTypes),j=x(w);return console.log("ForecastWidget: Rendering main forecast UI with data:",{selectedForecast:g,overallLevel:w,levelInfo:j,dailyForecastsLength:t.dailyForecasts.length}),e.jsxs("div",{className:"bg-white rounded-xl p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-1",children:"Pollen Forecast"}),e.jsx("p",{className:"text-sm text-gray-600",children:((N=s.address)==null?void 0:N.split(",")[0])||"Your location"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-lg mr-2",children:y.icon}),e.jsxs("h3",{className:"text-sm font-semibold text-blue-900",children:[y.season," Pollen Season"]})]}),e.jsx("p",{className:"text-sm text-blue-800",children:y.description}),y.primary!=="None"&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:'Other pollen types may show as "Out of Season" during this time.'})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:S(g.date)}),e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("span",{className:"text-2xl mr-3",children:j.emoji}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:j.description}),e.jsx("div",{className:"text-gray-600",children:j.advice})]})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4 mb-4",children:Object.entries(g.pollenTypes).map(([f,k])=>{const I=H.convertCategoryToLevel(k.category,k.index),v=x(I),A=I!=="unknown",C=y.primary.toLowerCase()===f;return e.jsxs("div",{className:`text-center p-3 rounded-lg border ${C?"border-blue-200 bg-blue-50":A?"border-green-200 bg-green-50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 mb-2 capitalize flex items-center justify-center",children:[f,C&&e.jsx("span",{className:"ml-1 text-xs",children:"🌟"})]}),e.jsx("div",{className:"w-6 h-6 rounded-full mx-auto mb-2 border-2 border-white shadow-sm",style:{backgroundColor:v.color}}),e.jsx("div",{className:`text-xs font-medium ${A?"text-gray-700":"text-gray-500"}`,children:v.description}),k.index>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Index: ",k.index]})]},f)})}),((h=g.healthRecommendations)==null?void 0:h.length)>0&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsx("div",{className:"space-y-1",children:g.healthRecommendations.slice(0,2).map((f,k)=>e.jsxs("div",{className:"text-sm text-gray-700",children:["• ",f]},k))})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"5-Day Forecast"}),e.jsx("div",{className:"text-xs text-green-600 bg-green-50 px-2 py-1 rounded",children:"National Data"})]}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:t.dailyForecasts.map((f,k)=>{const I=H.getOverallPollenLevel(f.pollenTypes),v=x(I),A=k===c;return e.jsxs("button",{onClick:()=>i(k),className:`p-3 rounded-lg text-center transition-all ${A?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-2",children:S(f.date,!0)}),e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"text-lg",children:v.emoji})}),e.jsx("div",{className:"text-xs text-gray-700 font-medium",children:v.description})]},k)})})]}),e.jsx("div",{className:"pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[g.confidence&&e.jsxs("span",{children:["Confidence: ",Math.round(g.confidence*100),"%"]}),((b=t.metadata)==null?void 0:b.source)==="demo"&&e.jsx("span",{className:"text-orange-600",children:"Demo Mode"})]}),e.jsx("span",{children:"Google Pollen API"})]})})]})}function Xe({onLocationSet:s,showTitle:t=!0}){var p,N;const{location:a,isLoading:r,error:o,requestGPSLocation:l,setZipCode:n,clearLocation:c,permissionStatus:i}=ne(),[d,u]=m.useState(""),[x,P]=m.useState("gps"),S=async()=>{try{const h=await l();s&&s(h)}catch(h){console.error("GPS location failed:",h)}},g=async h=>{if(h.preventDefault(),d.length===5)try{const b=await n(d);s&&s(b)}catch(b){console.error("ZIP code failed:",b)}},y=h=>{const b=h.target.value.replace(/\D/g,"").slice(0,5);u(b)},w=()=>r&&x==="gps"?"Getting location...":i==="denied"?"Location denied":(a==null?void 0:a.source)==="gps"?"Update GPS":"Use GPS",j=()=>r||i==="denied";return e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4",children:[t&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center",children:[e.jsx(V,{className:"w-5 h-5 mr-2 text-blue-600"}),"Set Your Location"]}),a&&e.jsx("button",{onClick:c,className:"text-sm text-gray-500 hover:text-gray-700",children:"Clear"})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 mb-4",children:[e.jsxs("button",{onClick:()=>P("gps"),className:`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors ${x==="gps"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Ge,{className:"w-4 h-4 inline mr-1"}),"GPS"]}),e.jsx("button",{onClick:()=>P("zip"),className:`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors ${x==="zip"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"ZIP Code"})]}),x==="gps"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:S,disabled:j(),className:`w-full py-3 px-4 rounded-lg font-medium flex items-center justify-center transition-colors ${j()?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[r&&x==="gps"?e.jsx(st,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ge,{className:"w-4 h-4 mr-2"}),w()]}),i==="denied"&&e.jsxs("div",{className:"text-sm text-amber-600 bg-amber-50 p-3 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:"Location access denied"}),e.jsx("p",{children:"Please enable location services in your browser settings or use ZIP code instead."})]})]}),x==="zip"&&e.jsxs("form",{onSubmit:g,className:"space-y-3",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Enter ZIP code (e.g., 90210)",value:d,onChange:y,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",maxLength:5})}),e.jsxs("button",{type:"submit",disabled:d.length!==5||r&&x==="zip",className:"w-full py-3 px-4 bg-blue-600 text-white rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-700 transition-colors flex items-center justify-center",children:[r&&x==="zip"?e.jsx(st,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Set Location"]})]}),o&&e.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:o}),a&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(V,{className:"w-4 h-4 text-green-600 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Location set"}),e.jsx("p",{className:"text-sm text-green-700 truncate",children:a.address||`${(p=a.latitude)==null?void 0:p.toFixed(4)}, ${(N=a.longitude)==null?void 0:N.toFixed(4)}`}),a.source==="gps"&&a.accuracy&&e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Accuracy: ±",Math.round(a.accuracy),"m"]})]})]})}),e.jsx("div",{className:"mt-4 text-xs text-gray-500",children:e.jsx("p",{children:"Your location helps us show relevant pollen data for your area. GPS provides more accurate results."})})]})}function nr(){var b,f;const s=oe(),{user:t}=Pe(),{location:a}=ne(),[r,o]=m.useState(null),[l,n]=m.useState(!0),[c,i]=m.useState(null),[d,u]=m.useState({}),[x,P]=m.useState(!1),[S,g]=m.useState(!1),[y,w]=m.useState(!1);m.useEffect(()=>{j()},[a]);const j=async()=>{try{if(n(!0),i(null),!q.getLocalPollenData)throw console.error("getLocalPollenData function not found on crowdPollenAPI:",Object.keys(q)),new Error("API function not available - please refresh the page");if(a){const k=await q.getLocalPollenData(a.latitude,a.longitude),I=await q.getLocalReportCounts(a.latitude,a.longitude,a.zip_code);u(I),o(k)}else{const k=await q.getNationalPollenData();o(k)}}catch(k){console.error("Failed to load pollen data:",k),i(k.message||"Unable to load pollen data");const I=new Date,v=I.getMonth();let A="moderate",C=25,E="Mixed";v>=2&&v<=5?(A="high",C=45,E="Tree"):v>=6&&v<=8?(A="moderate",C=30,E="Grass"):v>=9&&v<=10&&(A="moderate",C=35,E="Weed"),o({current_level:A,count:C,trend:"stable",forecast:`${A.charAt(0).toUpperCase()+A.slice(1)} ${E.toLowerCase()} pollen levels expected`,last_updated:I.toISOString(),local_reports:a?12:156,current:{totalPollenCount:C,densityLevel:A.charAt(0).toUpperCase()+A.slice(1),mainPollenType:E}})}finally{n(!1)}},p=k=>{const I={very_low:{color:"#34C759",emoji:"🟢",description:"Very Low",advice:"Perfect day to be outside"},low:{color:"#34C759",emoji:"🟢",description:"Low",advice:"Great conditions for outdoor activities"},moderate:{color:"#FF9500",emoji:"🟡",description:"Moderate",advice:"Good day for most activities"},high:{color:"#FF3B30",emoji:"🟠",description:"High",advice:"Consider limiting outdoor time"},very_high:{color:"#FF3B30",emoji:"🔴",description:"Very High",advice:"Stay indoors if possible"}};return I[k]||I.moderate};if(l)return e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-gray-300 border-t-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading pollen data..."})]})});const N=p((r==null?void 0:r.current_level)||"moderate"),h=(r==null?void 0:r.current_level)==="none"||(r==null?void 0:r.current_level)==="very_low"||(r==null?void 0:r.current_level)==="low";return e.jsxs("div",{className:"min-h-screen bg-white pb-20",children:[e.jsxs("div",{className:"px-6 pt-12 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:t?`Hello, ${((b=t.display_name)==null?void 0:b.split(" ")[0])||"there"}`:"CrowdPollen"}),e.jsx("p",{className:"text-gray-600 mt-1",children:a?((f=a.address)==null?void 0:f.split(",")[0])||"Your location":"Set your location"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>s("/help"),className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors",children:e.jsx(xe,{className:"w-5 h-5 text-gray-600"})}),e.jsx("button",{onClick:()=>s("/settings"),className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors",children:t?e.jsx("span",{className:"text-lg font-medium text-gray-700",children:(t.display_name||t.email||"U")[0].toUpperCase()}):e.jsx(vt,{className:"w-5 h-5 text-gray-600"})})]})]}),!t&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl mb-6 text-white overflow-hidden",children:[e.jsx("button",{onClick:()=>g(!S),className:"w-full p-4 text-left hover:bg-white/10 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Join CrowdPollen Platform"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Coming soon - Choose your contribution level"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"bg-white/20 text-xs px-2 py-1 rounded-full",children:"3 Modes"}),S?e.jsx(ls,{className:"w-5 h-5"}):e.jsx(is,{className:"w-5 h-5"})]})]})}),S&&e.jsxs("div",{className:"px-4 pb-4 space-y-3 border-t border-white/20 pt-4",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-lg mr-2",children:"👤"}),e.jsx("h4",{className:"font-semibold",children:"Individual Contributor"})]}),e.jsx("p",{className:"text-blue-100 text-sm mb-2",children:"Perfect for personal allergy tracking and community contribution"}),e.jsxs("ul",{className:"text-xs text-blue-200 space-y-1",children:[e.jsx("li",{children:"• Sync data across all your devices"}),e.jsx("li",{children:"• Personal allergy insights & trends"}),e.jsx("li",{children:"• Contribute to community science"}),e.jsx("li",{children:"• Access to premium forecast features"})]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-lg mr-2",children:"🎓"}),e.jsx("h4",{className:"font-semibold",children:"Teacher & Educator"})]}),e.jsx("p",{className:"text-blue-100 text-sm mb-2",children:"Engage students in real environmental science"}),e.jsxs("ul",{className:"text-xs text-blue-200 space-y-1",children:[e.jsx("li",{children:"• Classroom dashboard for student data"}),e.jsx("li",{children:"• Educational resources & lesson plans"}),e.jsx("li",{children:"• Student progress tracking"}),e.jsx("li",{children:"• Bulk data export for projects"})]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-lg mr-2",children:"🔬"}),e.jsx("h4",{className:"font-semibold",children:"Research & Expert"})]}),e.jsx("p",{className:"text-blue-100 text-sm mb-2",children:"Advanced tools for researchers and professionals"}),e.jsxs("ul",{className:"text-xs text-blue-200 space-y-1",children:[e.jsx("li",{children:"• Raw data access & API endpoints"}),e.jsx("li",{children:"• Advanced analytics & visualizations"}),e.jsx("li",{children:"• Evaluate & tag submitted images for model training"}),e.jsx("li",{children:"• Custom research project tools"}),e.jsx("li",{children:"• Priority support & collaboration"})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 text-center",children:[e.jsxs("p",{className:"text-blue-200 text-sm mb-2",children:["🚀 ",e.jsx("strong",{children:"Coming Soon"})]}),e.jsx("p",{className:"text-xs text-blue-300",children:"Join our waitlist to be notified when registration opens"}),e.jsx("button",{disabled:!0,className:"mt-2 bg-white/20 text-white px-4 py-2 rounded-lg font-medium text-sm cursor-not-allowed opacity-75",children:"Join Waitlist (Coming Soon)"})]})]})]}),!a&&e.jsx("button",{onClick:()=>P(!0),className:"w-full bg-blue-50 rounded-xl p-4 mb-6 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-blue-900 font-medium",children:"Location Required"}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Tap to set your location for personalized pollen data"})]})]})}),t?e.jsx("div",{className:"bg-green-50 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(xe,{className:"w-4 h-4 text-green-600 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("p",{className:"font-medium text-green-800 mb-1",children:"Contributing to Science"}),e.jsx("p",{children:"Your submissions help researchers understand pollen patterns and improve allergy forecasts for everyone."})]})]})}):e.jsx("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex",children:[e.jsx(xe,{className:"w-4 h-4 text-gray-500 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-1",children:"Anonymous Mode"}),e.jsx("p",{children:"Your data is stored locally on your device only. Sign up to sync across devices and contribute to citizen science research."})]})]}),e.jsxs("div",{className:"relative group ml-4",children:[e.jsx("button",{onClick:()=>{localStorage.clear(),sessionStorage.clear(),window.location.href="/"},className:"text-xs text-red-500 hover:underline",children:"Clear"}),e.jsx("div",{className:"absolute bottom-full mb-1 right-0 bg-gray-800 text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 whitespace-nowrap max-w-xs text-center",children:"Clear all local data & location"})]})]})})]}),e.jsxs("div",{className:"px-6 space-y-6",children:[e.jsxs("div",{className:"relative bg-white rounded-xl border border-gray-100 p-6 overflow-hidden",children:[h&&e.jsx("div",{className:"absolute inset-0 pointer-events-none z-0",children:[...Array(3)].map((k,I)=>e.jsx("div",{className:"absolute w-0.5 h-0.5 bg-transparent left-1/2 top-1/2",style:{animation:`firework-burst 1s ease-out ${I*.4}s forwards`,transformOrigin:"center"},children:[...Array(8)].map((v,A)=>e.jsx("div",{className:"absolute w-1 h-1 rounded-full",style:{backgroundColor:["#34d399","#60a5fa","#a78bfa"][A%3],transform:`rotate(${A*45}deg) translateX(0)`,animation:`firework-particle 1s ease-out ${I*.4}s forwards`}},A))},I))}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4 border-b border-gray-200 pb-1",children:"Current Conditions"}),a?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-3xl mr-4",children:N.emoji}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:N.description}),e.jsxs("p",{className:"text-gray-600",children:[(r==null?void 0:r.count)||0," grains/m³"]})]})]}),e.jsx("div",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"Hyper-Local Data"})]}):e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(xe,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{children:"Location Required to show today's pollen level"})]})]}),a&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-gray-700 font-medium",children:N.advice})}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Updates as community reports come in • Defaults to Google data for this location when insufficient local reports"}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[d["0.5 miles"]??(r==null?void 0:r.local_reports)??0," local reports"]}),e.jsx("button",{onClick:()=>w(!y),className:"text-blue-600 hover:underline text-xs",children:y?"Hide details":"Show details"})]}),y&&Object.values(d).some(k=>k>0)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-xs text-gray-500 mb-2",children:"Nearby Reports"}),e.jsx("div",{className:"grid grid-cols-5 gap-2 text-center text-[10px] text-gray-600",children:["0.5 miles","1 mile","5 miles","10 miles","zip_code"].map(k=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:d[k]??0}),e.jsx("div",{children:k})]},k))})]})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 px-1 mt-8 mb-2 border-b border-gray-200 pb-1",children:"Forecast"}),e.jsx(or,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>s("/camera"),className:"bg-blue-500 text-white p-4 rounded-xl font-medium flex items-center justify-center space-x-3 hover:bg-blue-600 transition-colors",children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsx("span",{children:"Submit Reading"})]}),e.jsxs("button",{onClick:()=>s("/map"),className:"bg-white border border-gray-200 text-gray-900 p-4 rounded-xl font-medium flex items-center justify-center space-x-3 hover:bg-gray-50 transition-colors",children:[e.jsx(Me,{className:"w-5 h-5"}),e.jsx("span",{children:"View Map"})]})]}),((r==null?void 0:r.current_level)==="high"||(r==null?void 0:r.current_level)==="very_high")&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(je,{className:"w-5 h-5 text-orange-600 mr-3 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-orange-900 mb-2",children:"High Pollen Alert"}),e.jsx("p",{className:"text-sm text-orange-800 mb-3",children:"Consider taking allergy medication and limiting outdoor activities. Keep windows closed and use air conditioning when possible."}),e.jsx("button",{onClick:()=>s("/symptoms"),className:"text-sm text-orange-700 font-medium hover:text-orange-800",children:"Log your symptoms →"})]})]})}),c&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"w-5 h-5 text-red-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-800 mb-2",children:c}),e.jsx("button",{onClick:j,className:"text-sm text-red-700 font-medium hover:text-red-800",children:"Try again"})]})]})}),t&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Your Activity"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Last submission"}),e.jsx("span",{className:"font-medium text-gray-900",children:"2 days ago"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total submissions"}),e.jsx("span",{className:"font-medium text-gray-900",children:"12"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Current streak"}),e.jsx("span",{className:"font-medium text-gray-900",children:"5 days 🔥"})]})]}),e.jsx("button",{onClick:()=>s("/history"),className:"w-full mt-4 py-3 text-blue-600 font-medium hover:text-blue-700 transition-colors",children:"View full history"})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-6 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Set Location"}),e.jsx("button",{onClick:()=>P(!1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Y,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx(Xe,{onLocationSet:()=>P(!1),showTitle:!1})]})})]})}function lr({onCapture:s,onClose:t}){const a=m.useRef(null),r=m.useRef(null),o=m.useRef(null),[l,n]=m.useState(!1),[c,i]=m.useState(null),[d,u]=m.useState("environment"),[x,P]=m.useState(!1),[S,g]=m.useState(!1),y=m.useCallback(async()=>{try{o.current&&o.current.getTracks().forEach(f=>f.stop());const h={video:{facingMode:d,width:{ideal:1920,max:1920},height:{ideal:1080,max:1080}}},b=await navigator.mediaDevices.getUserMedia(h);a.current&&(a.current.srcObject=b,o.current=b,n(!0),i(!0))}catch(h){console.error("Camera access denied:",h),i(!1)}},[d]),w=m.useCallback(()=>{o.current&&(o.current.getTracks().forEach(h=>h.stop()),o.current=null,n(!1))},[]),j=m.useCallback(()=>{u(h=>h==="environment"?"user":"environment")},[]),p=m.useCallback(async()=>{if(o.current){const h=o.current.getVideoTracks()[0];if(h&&h.getCapabilities&&h.getCapabilities().torch)try{await h.applyConstraints({advanced:[{torch:!x}]}),P(!x)}catch(f){console.warn("Flash not supported:",f)}}},[x]),N=m.useCallback(async()=>{if(!(!a.current||!r.current||S)){g(!0);try{const h=a.current,b=r.current,f=b.getContext("2d");b.width=h.videoWidth,b.height=h.videoHeight,f.drawImage(h,0,0);const k=await new Promise(I=>{b.toBlob(I,"image/jpeg",.9)});if(k){const I=document.createElement("div");I.className="fixed inset-0 bg-white z-50 pointer-events-none",I.style.animation="flash 0.2s ease-out",document.body.appendChild(I),setTimeout(()=>{document.body.removeChild(I)},200),s(k),w()}}catch(h){console.error("Capture error:",h)}finally{g(!1)}}},[s,w,S]);return m.useEffect(()=>(y(),()=>w()),[y,w]),m.useEffect(()=>{const h=document.createElement("style");return h.textContent=`
      @keyframes flash {
        0% { opacity: 0; }
        50% { opacity: 0.8; }
        100% { opacity: 0; }
      }
    `,document.head.appendChild(h),()=>document.head.removeChild(h)},[]),c===!1?e.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center p-6 z-50",children:e.jsx("div",{className:"bg-white rounded-xl p-6 max-w-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Ue,{className:"w-8 h-8 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Camera Access Required"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please allow camera access to take photos of your pollen trap."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:y,className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium",children:"Try Again"}),e.jsx("button",{onClick:t,className:"w-full bg-gray-200 text-gray-800 py-3 rounded-lg font-medium",children:"Close"})]})]})})}):e.jsxs("div",{className:"fixed inset-0 bg-black z-50",children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 z-10 p-4 flex justify-between items-center safe-area-top",children:[e.jsx("button",{onClick:t,className:"bg-black/50 text-white p-3 rounded-full backdrop-blur-sm",children:e.jsx(Ue,{className:"w-6 h-6"})}),e.jsx("div",{className:"bg-black/70 text-white px-4 py-2 rounded-full text-sm backdrop-blur-sm",children:"Center trap in frame"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:p,className:"bg-black/50 text-white p-3 rounded-full backdrop-blur-sm",children:x?e.jsx(cs,{className:"w-6 h-6"}):e.jsx(ds,{className:"w-6 h-6"})}),e.jsx("button",{onClick:j,className:"bg-black/50 text-white p-3 rounded-full backdrop-blur-sm",children:e.jsx(ms,{className:"w-6 h-6"})})]})]}),e.jsx("video",{ref:a,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"relative w-64 h-64",children:[e.jsx("div",{className:"absolute top-0 left-0 w-12 h-12 border-t-4 border-l-4 border-white rounded-tl-lg opacity-80"}),e.jsx("div",{className:"absolute top-0 right-0 w-12 h-12 border-t-4 border-r-4 border-white rounded-tr-lg opacity-80"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-12 h-12 border-b-4 border-l-4 border-white rounded-bl-lg opacity-80"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-12 h-12 border-b-4 border-r-4 border-white rounded-br-lg opacity-80"}),e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:[e.jsx("div",{className:"w-8 h-0.5 bg-white opacity-60"}),e.jsx("div",{className:"w-0.5 h-8 bg-white opacity-60 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})]})]})})}),e.jsx("div",{className:"absolute bottom-32 left-1/2 transform -translate-x-1/2 pointer-events-none",children:e.jsx("div",{className:"bg-white/90 p-4 rounded-lg backdrop-blur-sm max-w-xs",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"relative w-32 h-20 bg-yellow-50 rounded mb-2 mx-auto",children:[...Array(6)].map((h,b)=>e.jsx("div",{className:"absolute w-2 h-2 bg-yellow-600 rounded-full animate-pulse",style:{animationDelay:`${b*.5}s`,top:`${20+Math.random()*40}%`,left:`${10+Math.random()*80}%`}},b))}),e.jsx("p",{className:"text-xs text-gray-700 font-medium",children:"Pollen grains will look like yellow dots"})]})})}),e.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 safe-area-bottom",children:e.jsxs("button",{onClick:N,disabled:!l||S,className:"relative w-20 h-20 bg-white rounded-full shadow-lg disabled:opacity-50 transition-all duration-200 active:scale-95",children:[e.jsx("div",{className:`absolute inset-2 bg-white rounded-full border-4 transition-colors ${S?"border-blue-500":"border-gray-300"}`}),S&&e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-blue-500 animate-ping"})]})}),e.jsx("canvas",{ref:r,className:"hidden"})]})}function ir({capturedImage:s}){const[t,a]=m.useState(0),[r,o]=m.useState(0),l=[{text:"Uploading image...",duration:1200,progress:25,icon:"📤"},{text:"Analyzing pollen grains...",duration:2e3,progress:50,icon:"🔍"},{text:"Identifying species...",duration:1800,progress:75,icon:"🧬"},{text:"Saving to database...",duration:1e3,progress:100,icon:"💾"}];return m.useEffect(()=>{let n;const c=()=>{t<l.length-1&&(a(i=>i+1),o(l[t+1].progress),n=setTimeout(c,l[t+1].duration))};return o(l[0].progress),n=setTimeout(c,l[0].duration),()=>{n&&clearTimeout(n)}},[t,l]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-6",children:e.jsxs("div",{className:"text-center max-w-sm w-full",children:[s&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s,alt:"Captured pollen trap",className:"w-48 h-48 object-cover rounded-2xl mx-auto shadow-2xl border-4 border-white"}),e.jsxs("div",{className:"absolute inset-0 rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-blue-200/30 to-transparent animate-pulse"}),e.jsx("div",{className:"absolute left-0 right-0 h-1 bg-gradient-to-r from-transparent via-blue-500 to-transparent animate-bounce",style:{top:`${20+r*.6}%`,animationDuration:"2s"}})]})]})}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"text-8xl mb-6 animate-spin inline-block",style:{animationDuration:"2s",animationTimingFunction:"linear"},children:"🌿"})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-3",children:"Analyzing Sample"}),e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[e.jsx("span",{className:"text-2xl mr-3 animate-bounce",style:{animationDelay:"0.1s"},children:l[t].icon}),e.jsx("p",{className:"text-lg text-gray-700 font-medium",children:l[t].text})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Our AI is counting pollen grains and identifying species..."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden shadow-inner",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full transition-all duration-1000 ease-out relative overflow-hidden",style:{width:`${r}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-pulse"})})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-2",children:[e.jsx("span",{children:"0%"}),e.jsxs("span",{className:"font-medium",children:[r,"%"]}),e.jsx("span",{children:"100%"})]})]}),e.jsx("div",{className:"flex justify-center space-x-3 mb-8",children:l.map((n,c)=>e.jsx("div",{className:`w-3 h-3 rounded-full transition-all duration-500 ${c<=t?"bg-blue-500 scale-110":"bg-gray-300"}`},c))}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl p-4 shadow-lg border border-white/50",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("div",{className:"text-lg mr-2",children:"🤖"}),e.jsx("h3",{className:"font-semibold text-gray-800",children:"AI Model v2.1"})]}),e.jsxs("p",{className:"text-xs text-gray-600 leading-relaxed",children:["Using advanced computer vision to detect and classify pollen grains with",e.jsx("span",{className:"font-semibold text-blue-600",children:" 94% accuracy"})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Neural network layers:"}),e.jsx("span",{className:"font-mono text-gray-700",children:"127"})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Training samples:"}),e.jsx("span",{className:"font-mono text-gray-700",children:"2.3M"})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Species database:"}),e.jsx("span",{className:"font-mono text-gray-700",children:"450+"})]})]})]}),e.jsx("div",{className:"mt-6 bg-gradient-to-r from-green-50 to-yellow-50 rounded-xl p-3 border border-green-200",children:e.jsxs("div",{className:"text-xs text-green-800",children:[e.jsx("span",{className:"font-semibold",children:"💡 Did you know?"}),e.jsxs("div",{className:"mt-1",children:[t===0&&"A single oak tree can produce up to 10 million pollen grains per day!",t===1&&"Pollen grains are so small that 1,000 could fit on a pinhead.",t===2&&"Each plant species has uniquely shaped pollen - like fingerprints!",t===3&&"Your data helps scientists track climate change effects on plants."]})]})}),e.jsx("div",{className:"mt-4",children:e.jsx("p",{className:"text-xs text-gray-500",children:"⏱️ This usually takes 15-30 seconds"})})]})})}function cr({results:s,capturedImage:t,location:a,onBack:r,onRetake:o,onViewMap:l,onLogSymptoms:n,onNewSubmission:c}){var p,N,h;const[i,d]=m.useState(!1),[u,x]=m.useState(!0),[P,S]=m.useState(!1),y=((b,f=0)=>{if(f===0)return{color:"text-emerald-600",bg:"bg-emerald-50",border:"border-emerald-200",emoji:"🌱",label:"No Pollen Detected",description:"Perfect conditions - no pollen found in your sample!"};const k={none:{color:"text-emerald-600",bg:"bg-emerald-50",border:"border-emerald-200",emoji:"🌱",label:"None",description:"Perfect conditions - no pollen detected!"},very_low:{color:"text-green-600",bg:"bg-green-50",border:"border-green-200",emoji:"🌱",label:"Very Low",description:"Excellent conditions for outdoor activities"},low:{color:"text-green-600",bg:"bg-green-50",border:"border-green-200",emoji:"🟢",label:"Low",description:"Good conditions for most people"},moderate:{color:"text-yellow-600",bg:"bg-yellow-50",border:"border-yellow-200",emoji:"🟡",label:"Moderate",description:"Sensitive individuals may experience symptoms"},high:{color:"text-orange-600",bg:"bg-orange-50",border:"border-orange-200",emoji:"🟠",label:"High",description:"Most allergy sufferers will experience symptoms"},very_high:{color:"text-red-600",bg:"bg-red-50",border:"border-red-200",emoji:"🔴",label:"Very High",description:"Avoid outdoor activities if possible"}};return k[b]||k.moderate})(s.pollen_density,s.pollen_count),w=Math.round(s.confidence_score*100),j=((p=s.plant_species)==null?void 0:p.map((b,f)=>({name:b,count:Math.floor(Math.random()*(s.pollen_count/s.plant_species.length))+1,percentage:Math.floor(Math.random()*40)+20})))||[];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 safe-area-top",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("button",{onClick:r,className:"mr-3 p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(Y,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-semibold",children:"Analysis Complete"})]}),e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-6xl mb-4",children:y.emoji}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:y.label}),e.jsx("p",{className:"text-blue-100 mb-4",children:s.pollen_count===0?"No pollen grains found in your sample":`${s.pollen_count} grains detected in your sample`}),e.jsxs("div",{className:"inline-flex items-center bg-white/20 rounded-full px-4 py-2",children:[e.jsx(us,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Analysis Complete"})]})]})]}),e.jsxs("div",{className:"p-4 space-y-4 pb-20",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border-2 border-green-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4",children:e.jsx("span",{className:"text-2xl",children:"✅"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-green-800 text-lg",children:"Data Successfully Saved!"}),e.jsx("p",{className:"text-green-700 text-sm",children:"Your reading has been added to the community database"})]})]})}),t&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[e.jsx("span",{className:"text-lg mr-2",children:"📸"}),"Analyzed Image"]}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t,alt:"Analyzed pollen trap",className:"w-full h-48 object-cover rounded-xl border-2 border-gray-200"}),e.jsx("div",{className:"absolute top-2 right-2 bg-black/70 text-white px-2 py-1 rounded-lg text-xs",children:"AI Analyzed ✨"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold text-lg flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:"🔍"}),"Detection Results"]}),e.jsx("button",{onClick:()=>S(!P),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:`relative min-h-[120px] p-6 rounded-xl text-center border cursor-help overflow-hidden ${s.pollen_count===0?"bg-gradient-to-br from-gray-100 to-gray-200 border-gray-300":"bg-gradient-to-br from-yellow-50 to-orange-50 border-yellow-200"}`,onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),onClick:()=>S(!P),children:[s.pollen_count===0&&e.jsxs("div",{className:"absolute inset-0 pointer-events-none z-0 flex flex-col items-center justify-center animate-fade-in delay-500",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-3xl",children:[e.jsx("span",{className:"animate-bounce",children:"🎉"}),e.jsxs("span",{className:"relative text-4xl font-bold text-black",children:[e.jsx("span",{className:"absolute left-0 top-0 opacity-30",children:"0"}),e.jsx("span",{className:"absolute left-0 top-0 opacity-50",children:"0"}),e.jsx("span",{className:"relative",children:"0"})]}),e.jsx("span",{className:"animate-bounce",children:"🎉"})]}),e.jsx("div",{className:"text-sm font-medium text-black mt-2",children:"Total Grains"})]}),s.pollen_count!==0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative z-10 text-3xl font-bold text-orange-600",children:s.pollen_count}),e.jsx("div",{className:"text-sm font-medium text-orange-700",children:"Total Grains"})]}),P&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 z-10 w-72",children:e.jsxs("div",{className:"bg-gray-800 text-white text-sm rounded-lg px-3 py-2 shadow-lg",children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsxs("div",{className:"font-semibold",children:[w,"% Confidence"]}),e.jsx("div",{className:"text-xs text-gray-300 mt-1",children:"AI model accuracy"})]}),e.jsxs("div",{className:"text-xs text-gray-200 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Model:"})," PollenNet v1.2"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Training Images:"})," 12,000+"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Species Known:"})," 38"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Neural Layers:"})," 18"]})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})})]})}),e.jsxs("div",{className:`p-4 rounded-xl border-2 ${y.bg} ${y.border}`,children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-xl mr-2",children:y.emoji}),e.jsxs("span",{className:`font-semibold ${y.color}`,children:[y.label," Level"]})]}),e.jsx("p",{className:`text-sm ${y.color}`,children:y.description})]})]}),s.pollen_count>0&&j.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:"🌿"}),"Pollen Types Found"]}),e.jsx("div",{className:"space-y-4",children:j.map((b,f)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-3"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:b.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[b.count," grains detected"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-700",children:[b.percentage,"%"]}),e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-1000",style:{width:`${b.percentage}%`}})})]})]},f))})]}),s.weather_conditions&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-bold text-lg flex items-center",children:[e.jsx(hs,{className:"w-5 h-5 mr-2 text-blue-600"}),"Weather Conditions"]}),e.jsxs("button",{onClick:()=>x(!u),className:"flex items-center space-x-2 text-sm text-blue-600 hover:underline",children:[u?e.jsx(xs,{className:"w-5 h-5"}):e.jsx(gs,{className:"w-5 h-5"}),e.jsx("span",{children:u?"Imperial":"Metric"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u?`${Math.round(s.weather_conditions.temperature*9/5+32)}°F`:`${s.weather_conditions.temperature}°C`}),e.jsx("div",{className:"text-xs text-blue-700 font-medium",children:"Temperature"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-xl",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[s.weather_conditions.humidity,"%"]}),e.jsx("div",{className:"text-xs text-blue-700 font-medium",children:"Humidity"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u?`${Math.round(s.weather_conditions.wind_speed*.621371)} mph`:`${s.weather_conditions.wind_speed} km/h`}),e.jsxs("div",{className:"text-xs text-blue-700 font-medium",children:["Wind ",u?"mph":"km/h"]})]})]})]}),a&&e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-5 h-5 text-gray-400 mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:"Reading Location"}),e.jsx("div",{className:"text-sm text-gray-600",children:a.address||`${(N=a.latitude)==null?void 0:N.toFixed(4)}, ${(h=a.longitude)==null?void 0:h.toFixed(4)}`})]})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl shadow-lg p-6 border border-green-200",children:[e.jsxs("h3",{className:"font-bold text-lg mb-3 flex items-center",children:[e.jsx(fe,{className:"w-5 h-5 mr-2 text-green-600"}),"Community Impact"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"+1"}),e.jsx("div",{className:"text-xs text-green-700",children:"Your Contribution"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"2,847"}),e.jsx("div",{className:"text-xs text-green-700",children:"Total This Week"})]})]}),e.jsx("p",{className:"text-sm text-green-800 bg-white/70 rounded-lg p-3",children:"🌍 Your data helps improve pollen forecasts for everyone in your community!"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:n,className:"w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-2xl font-semibold text-lg shadow-lg flex items-center justify-center space-x-2",children:[e.jsx("span",{children:"📝"}),e.jsx("span",{children:"Log How You Feel"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:l,className:"py-3 bg-white border-2 border-blue-200 text-blue-700 rounded-xl font-medium shadow-sm hover:bg-blue-50 transition-colors",children:"🗺️ View on Map"}),e.jsxs("button",{onClick:()=>d(!0),className:"py-3 bg-white border-2 border-green-200 text-green-700 rounded-xl font-medium shadow-sm hover:bg-green-50 transition-colors flex items-center justify-center space-x-1",children:[e.jsx(ps,{className:"w-4 h-4"}),e.jsx("span",{children:"Share"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:o,className:"py-3 bg-gray-100 text-gray-700 rounded-xl font-medium",children:"📷 Retake Photo"}),e.jsx("button",{onClick:c,className:"py-3 bg-gray-100 text-gray-700 rounded-xl font-medium",children:"➕ New Reading"})]})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-center",children:"Share Your Results"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"w-full py-3 bg-blue-600 text-white rounded-xl font-medium",children:"📱 Share to Social Media"}),e.jsx("button",{className:"w-full py-3 bg-green-600 text-white rounded-xl font-medium",children:"💬 Send to Friends"}),e.jsx("button",{className:"w-full py-3 bg-purple-600 text-white rounded-xl font-medium",children:"📧 Email Results"}),e.jsx("button",{onClick:()=>d(!1),className:"w-full py-2 text-gray-600 text-sm",children:"Cancel"})]})]})})]})]})}function dr(){var h;const s=oe(),{user:t}=Pe(),{location:a}=ne(),[r,o]=m.useState(!1),[l,n]=m.useState(!1),[c,i]=m.useState(!1),[d,u]=m.useState(null),[x,P]=m.useState(null),[S,g]=m.useState(!1),y=async b=>{try{if(i(!0),o(!1),P(URL.createObjectURL(b)),!a){n(!0);return}await w(b,a)}catch(f){console.error("Capture error:",f),i(!1)}},w=async(b,f)=>{try{i(!0);const k=await q.submitPollenReading({image:b,location:f,user_id:(t==null?void 0:t.id)||null,timestamp:new Date().toISOString()});u(k)}catch(k){console.error("Processing error:",k),u({id:"demo-"+Date.now(),pollen_density:"moderate",pollen_count:Math.floor(Math.random()*50)+10,confidence_score:.75+Math.random()*.2,plant_species:["Oak","Birch","Grass"],advice:"Moderate pollen levels detected. Sensitive individuals may experience mild symptoms.",weather_conditions:{temperature:22,humidity:65,wind_speed:8}})}finally{i(!1)}},j=async b=>{if(n(!1),x){const k=await(await fetch(x)).blob();await w(k,b)}},p=()=>{u(null),P(null),o(!0)},N=()=>{u(null),P(null),o(!1)};return r?e.jsx(lr,{onCapture:y,onClose:()=>o(!1)}):l?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Location Required"}),e.jsx("p",{className:"text-gray-600 mb-4 text-sm",children:"We need your location to provide accurate pollen data for your area."}),e.jsx(Xe,{onLocationSet:j,showTitle:!1}),e.jsx("button",{onClick:()=>{n(!1),i(!1),P(null)},className:"w-full mt-4 py-2 text-gray-600 text-sm",children:"Cancel"})]})}):c?e.jsx(ir,{capturedImage:x}):d?e.jsx(cr,{results:d,capturedImage:x,location:a,onBack:()=>s("/"),onRetake:p,onViewMap:()=>s("/map"),onLogSymptoms:()=>s("/symptoms"),onNewSubmission:N}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm p-4 safe-area-top",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>s("/"),className:"mr-3 p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Y,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-semibold",children:"Submit Pollen Reading"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[a?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-green-600 mr-2"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Location set"}),e.jsx("p",{className:"text-xs text-green-700",children:((h=a.address)==null?void 0:h.split(",")[0])||"Current location"})]}),e.jsx("button",{onClick:()=>n(!0),className:"text-xs text-green-600 underline",children:"Change"})]})}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-yellow-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Location required"})]}),e.jsx("button",{onClick:()=>n(!0),className:"text-sm text-yellow-600 underline",children:"Set location"})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Need a pollen trap?"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Learn how to make one in 5 minutes"})]})]}),e.jsx("button",{onClick:()=>g(!0),className:"text-sm text-blue-600 underline font-medium",children:"View Guide"})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center",children:[e.jsx(ee,{className:"w-5 h-5 mr-2 text-blue-600"}),"How to take a good photo"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5",children:e.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"1"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Place trap on flat surface"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Ensure the trap is stable and level"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5",children:e.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Ensure good lighting"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Avoid shadows and direct sunlight"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5",children:e.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"3"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Center trap in frame"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Use the guide lines to align properly"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5",children:e.jsx("span",{className:"text-xs font-semibold text-blue-600",children:"4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Hold camera steady"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Take a clear, focused photo"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"What pollen looks like"}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"relative w-32 h-20 bg-yellow-100 rounded mx-auto mb-2",children:[...Array(8)].map((b,f)=>e.jsx("div",{className:"absolute w-1.5 h-1.5 bg-yellow-600 rounded-full",style:{top:`${20+Math.random()*60}%`,left:`${10+Math.random()*80}%`}},f))}),e.jsx("p",{className:"text-xs text-gray-600",children:"Pollen grains appear as small yellow/brown dots"})]})]}),e.jsxs("button",{onClick:()=>o(!0),disabled:!a,className:"w-full py-4 bg-blue-600 text-white rounded-xl font-medium flex items-center justify-center space-x-2 shadow-md disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ee,{className:"w-6 h-6"}),e.jsx("span",{children:"Open Camera"})]}),!a&&e.jsx("p",{className:"text-center text-sm text-gray-500",children:"Please set your location first"}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Make a Pollen Trap"}),e.jsx("button",{onClick:()=>g(!1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Ue,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-blue-800",children:"⏱️ Time needed:"}),e.jsx("span",{className:"text-blue-700",children:"5 minutes"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"font-medium text-blue-800",children:"🕐 Best exposure:"}),e.jsx("span",{className:"text-blue-700",children:"1-3 hours (up to 24h)"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"What you'll need:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3"}),e.jsx("span",{className:"text-sm",children:"Clear tape or petroleum jelly"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3"}),e.jsx("span",{className:"text-sm",children:"Small plate or piece of cardboard"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3"}),e.jsx("span",{className:"text-sm",children:"Magnifying glass (optional)"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Instructions:"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5 flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:"1"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Prepare the surface"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Apply clear tape sticky-side up to a small plate, or spread a thin layer of petroleum jelly on the surface."})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5 flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:"2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Place outside"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Put your trap in an open area away from buildings. Avoid windy spots that might blow the trap away."})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5 flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:"3"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Wait for pollen"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Leave for 1-3 hours for quick results, or up to 24 hours for maximum collection. Best results on dry, breezy days."})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3 mt-0.5 flex-shrink-0",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:"4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Take a photo"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Bring your trap inside and use this app to photograph the collected pollen. Look for small yellow/brown dots."})]})]})]})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-yellow-800 mb-2",children:"💡 Pro Tips:"}),e.jsxs("div",{className:"space-y-1 text-xs text-yellow-700",children:[e.jsx("p",{children:"• Best time: Mid-morning on dry, breezy days"}),e.jsx("p",{children:"• Avoid rainy or very humid conditions"}),e.jsx("p",{children:"• Place multiple traps for better coverage"}),e.jsx("p",{children:"• Use a magnifying glass to see pollen better"})]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-green-800",children:[e.jsx("span",{className:"font-medium",children:"Remember:"})," This guide is always available on the submit page whenever you need it!"]})}),e.jsx("button",{onClick:()=>g(!1),className:"w-full py-3 bg-blue-600 text-white rounded-xl font-medium",children:"Got it!"})]})]})})]})]})}function mr(){const s=oe(),{location:t}=ne(),a=m.useRef(null),r=m.useRef(null),o=m.useRef([]),[l,n]=m.useState(!0),[c,i]=m.useState(null),[d,u]=m.useState([]),[x,P]=m.useState(null),[S]=m.useState("hybrid"),[g,y]=m.useState(null),[w,j]=m.useState(!0);m.useEffect(()=>(p(),()=>{b()}),[]),m.useEffect(()=>{r.current&&N()},[t,S]);const p=async()=>{try{if(n(!0),i(null),!F.isConfigured()){i("Google Maps API key not configured. Please add VITE_GOOGLE_MAPS_API_KEY to your environment.");return}let C={lat:40.7128,lng:-74.006},E=10;t&&(C={lat:t.latitude,lng:t.longitude},E=12);const _=await F.createMap(a.current,{center:C,zoom:E,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]}]});r.current=_,_.addListener("click",()=>{y(null)}),await N()}catch(C){console.error("Map initialization failed:",C),i("Failed to load map. Please check your internet connection.")}finally{n(!1)}},N=async()=>{if(r.current)try{n(!0),b();const C=[];(S==="crowd"||S==="hybrid")&&(t?C.push(q.getLocalSubmissions(t.latitude,t.longitude,16)):C.push(q.getNationalSubmissions())),(S==="forecast"||S==="hybrid")&&(t?C.push(H.getForecast(t.latitude,t.longitude)):C.push(Promise.resolve(null)));const E=await Promise.allSettled(C);let _=[],D=null;if(S==="crowd"||S==="hybrid"){const R=E[0];R.status==="fulfilled"?_=R.value||[]:_=h()}if(S==="forecast"||S==="hybrid"){const G=E[S==="hybrid"?1:0];G.status==="fulfilled"&&(D=G.value)}u(_),P(D),f(_,D)}catch(C){console.error("Failed to load map data:",C);const E=h();u(E),f(E,null)}finally{n(!1)}},h=()=>{const C=[],E=(t==null?void 0:t.latitude)||40.7128,_=(t==null?void 0:t.longitude)||-74.006,D=t?.1:2;for(let R=0;R<25;R++){const G=E+(Math.random()-.5)*D,te=_+(Math.random()-.5)*D,se=["very_low","low","moderate","high","very_high"],Q=se[Math.floor(Math.random()*se.length)];C.push({id:`mock-${R}`,latitude:G,longitude:te,pollen_density:Q,pollen_count:Math.floor(Math.random()*100)+5,confidence_score:.6+Math.random()*.4,created_at:new Date(Date.now()-Math.random()*7*24*60*60*1e3).toISOString(),address:`Location ${R+1}`,source:"crowd"})}return C},b=()=>{o.current.forEach(C=>{C.setMap(null)}),o.current=[]},f=(C,E)=>{if(r.current){if(t){const _=F.createMarker(r.current,{lat:t.latitude,lng:t.longitude},{icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#3B82F6",fillOpacity:1,strokeColor:"#FFFFFF",strokeWeight:2},title:"Your Location",zIndex:1e3});o.current.push(_)}if((S==="crowd"||S==="hybrid")&&C.forEach(_=>{const D=F.createMarker(r.current,{lat:_.latitude,lng:_.longitude},{icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:I(_.pollen_count),fillColor:k(_.pollen_density),fillOpacity:.8,strokeColor:"#FFFFFF",strokeWeight:1},title:`${_.pollen_density.replace("_"," ")} - ${_.pollen_count} grains/m³`});D.addListener("click",()=>{y(_)}),o.current.push(D)}),E&&(S==="forecast"||S==="hybrid")){const _=F.createMarker(r.current,{lat:t.latitude,lng:t.longitude},{icon:{path:window.google.maps.SymbolPath.FORWARD_CLOSED_ARROW,scale:6,fillColor:"#FF6B35",fillOpacity:.9,strokeColor:"#FFFFFF",strokeWeight:1},title:"Forecast Data Available"});o.current.push(_)}}},k=C=>({very_low:"#34C759",low:"#34C759",moderate:"#FF9500",high:"#FF3B30",very_high:"#FF3B30"})[C]||"#6B7280",I=C=>C<10?4:C<30?6:C<60?8:10,v=C=>{const E=new Date(C),D=Math.floor((new Date-E)/(1e3*60*60));return D<1?"Just now":D===1?"1 hour ago":D<24?`${D} hours ago`:`${Math.floor(D/24)} days ago`},A=()=>{t&&r.current&&(r.current.setCenter({lat:t.latitude,lng:t.longitude}),r.current.setZoom(12))};return F.isConfigured()?e.jsxs("div",{className:"min-h-screen bg-white pb-20",children:[e.jsx("div",{className:"px-6 pt-12 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>s("/"),className:"mr-4 p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Y,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Pollen Map"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:N,disabled:l,className:"p-2 hover:bg-gray-100 rounded-full transition-colors disabled:opacity-50",children:e.jsx(We,{className:`w-5 h-5 text-gray-600 ${l?"animate-spin":""}`})}),t&&e.jsx("button",{onClick:A,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Ge,{className:"w-5 h-5 text-gray-600"})}),e.jsx("button",{onClick:()=>j(!w),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(at,{className:"w-5 h-5 text-gray-600"})})]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:a,className:"h-96 w-full",style:{minHeight:"400px"}}),l&&e.jsx("div",{className:"absolute inset-0 bg-white/80 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-gray-300 border-t-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading map data..."})]})}),c&&e.jsx("div",{className:"absolute inset-0 bg-white/90 flex items-center justify-center p-6",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx(V,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Map Unavailable"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:c}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors",children:"Try Again"})]})}),w&&!l&&!c&&e.jsxs("div",{className:"absolute bottom-4 left-4 bg-white rounded-xl shadow-lg p-4 max-w-xs",children:[e.jsxs("h4",{className:"font-semibold text-sm mb-3 flex items-center",children:[e.jsx(at,{className:"w-4 h-4 mr-2"}),"Pollen Levels"]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-3"}),e.jsx("span",{children:"Low (0-30)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full mr-3"}),e.jsx("span",{children:"Moderate (31-60)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-3"}),e.jsx("span",{children:"High (60+)"})]}),t&&e.jsxs("div",{className:"flex items-center pt-2 border-t border-gray-200",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-3"}),e.jsx("span",{children:"Your Location"})]})]})]}),!l&&!c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-4 right-4 bg-white rounded-xl shadow-lg p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:d.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Reports"})]})}),e.jsxs("div",{className:"absolute top-4 left-4 bg-white rounded-xl shadow-lg p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Map Layers"}),e.jsxs("ul",{className:"space-y-1 text-xs text-gray-600",children:[e.jsx("li",{children:"• Community Reports (colored circles)"}),e.jsx("li",{children:"• Forecast Overlay (orange arrow)"})]})]})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-6 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-sm w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Pollen Report"}),e.jsx("button",{onClick:()=>y(null),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 rounded-full mr-3",style:{backgroundColor:k(g.pollen_density)}}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium capitalize",children:[g.pollen_density.replace("_"," ")," Level"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[g.pollen_count," grains/m³"]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Source"}),e.jsx("span",{className:"font-medium capitalize",children:g.source||"Community"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"Submitted"}),e.jsx("span",{className:"font-medium",children:v(g.created_at)})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:g.address||"Location not available"})]})]}),e.jsx("button",{onClick:()=>y(null),className:"w-full mt-6 py-3 bg-blue-500 text-white rounded-xl font-medium hover:bg-blue-600 transition-colors",children:"Close"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-white pb-20",children:[e.jsx("div",{className:"px-6 pt-12 pb-6",children:e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>s("/"),className:"mr-4 p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Y,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Pollen Map"})]})}),e.jsx("div",{className:"px-6",children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(V,{className:"w-6 h-6 text-yellow-600 mr-3 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-900 mb-2",children:"Google Maps Setup Required"}),e.jsx("p",{className:"text-yellow-800 mb-4",children:"To use the interactive map feature, you need to configure the Google Maps API key."}),e.jsx("div",{className:"bg-yellow-100 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-sm text-yellow-800 font-mono",children:"Add VITE_GOOGLE_MAPS_API_KEY to your .env file"})}),e.jsx("button",{onClick:()=>s("/map-fallback"),className:"text-yellow-700 font-medium hover:text-yellow-800",children:"Use simplified map view →"})]})]})})})]})}function ur(){return e.jsx(mr,{})}function hr({setScreen:s}){const{user:t}=Pe(),[a,r]=m.useState([]),[o,l]=m.useState(!1),[n,c]=m.useState(new Date().toISOString().split("T")[0]),[i,d]=m.useState(!0);m.useEffect(()=>{u()},[n]);const u=async()=>{try{if(d(!0),t){const j=await q.getUserSymptoms(t.id,n);r(j||[])}else{const j=localStorage.getItem(`symptoms_${n}`);r(j?JSON.parse(j):[])}}catch(j){console.error("Failed to load symptoms:",j),r([])}finally{d(!1)}},x=async j=>{try{const p={id:Date.now().toString(),date:n,timestamp:new Date().toISOString(),user_id:(t==null?void 0:t.id)||null,...j};if(t)await q.saveSymptom(p);else{const N=[...a,p];r(N),localStorage.setItem(`symptoms_${n}`,JSON.stringify(N))}l(!1),u()}catch(p){console.error("Failed to save symptom:",p)}},P=async j=>{try{if(t)await q.deleteSymptom(j);else{const p=a.filter(N=>N.id!==j);r(p),localStorage.setItem(`symptoms_${n}`,JSON.stringify(p))}u()}catch(p){console.error("Failed to delete symptom:",p)}},S=j=>{const p={mild:"text-green-600 bg-green-50",moderate:"text-yellow-600 bg-yellow-50",severe:"text-red-600 bg-red-50"};return p[j]||p.mild},g=j=>{switch(j){case"mild":return"😌";case"moderate":return"😐";case"severe":return"😣";default:return"😌"}},y=j=>new Date(j).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),w=({onClose:j,onSave:p})=>{const[N,h]=m.useState({type:"",severity:"mild",notes:"",triggers:[]}),b=["Sneezing","Runny nose","Stuffy nose","Itchy eyes","Watery eyes","Scratchy throat","Coughing","Headache","Fatigue","Other"],f=["Outdoor exposure","Open windows","Exercise outside","Gardening","Windy weather","High pollen count"],k=v=>{v.preventDefault(),N.type&&p(N)},I=v=>{h(A=>({...A,triggers:A.triggers.includes(v)?A.triggers.filter(C=>C!==v):[...A.triggers,v]}))};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Log Symptom"}),e.jsx("button",{onClick:j,className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Symptom Type"}),e.jsxs("select",{value:N.type,onChange:v=>h({...N,type:v.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select a symptom"}),b.map(v=>e.jsx("option",{value:v,children:v},v))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Severity"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["mild","moderate","severe"].map(v=>e.jsx("button",{type:"button",onClick:()=>h({...N,severity:v}),className:`p-3 rounded-lg border-2 transition-colors ${N.severity===v?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:g(v)}),e.jsx("div",{className:"text-sm font-medium capitalize",children:v})]})},v))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Possible Triggers"}),e.jsx("div",{className:"space-y-2",children:f.map(v=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:N.triggers.includes(v),onChange:()=>I(v),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:v})]},v))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:N.notes,onChange:v=>h({...N,notes:v.target.value}),placeholder:"Any additional details...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:j,className:"flex-1 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 bg-blue-600 text-white rounded-lg font-medium",children:"Save Symptom"})]})]})]})})};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsxs("div",{className:"bg-white shadow-sm p-4 safe-area-top",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>s("home"),className:"mr-3 p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Y,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-semibold",children:"Symptom Log"})]}),e.jsx("button",{onClick:()=>l(!0),className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:e.jsx(rt,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mt-4",children:e.jsx("input",{type:"date",value:n,onChange:j=>c(j.target.value),max:new Date().toISOString().split("T")[0],className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})})]}),e.jsxs("div",{className:"p-4",children:[!t&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3",children:"ℹ️"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-1",children:"Anonymous Mode"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Your symptoms are stored locally. Sign in to sync across devices and get personalized insights."})]})]})}),i?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📝"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No symptoms logged"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Track your allergy symptoms to identify patterns and triggers."}),e.jsxs("button",{onClick:()=>l(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg font-medium",children:[e.jsx(rt,{className:"w-4 h-4 mr-2"}),"Log First Symptom"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(fs,{className:"w-4 h-4 mr-2"}),new Date(n).toLocaleDateString([],{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:a.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Symptoms"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:a.filter(j=>j.severity==="severe").length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Severe"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:[...new Set(a.map(j=>j.type))].length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Types"})]})]})]}),e.jsx("div",{className:"space-y-3",children:a.map(j=>e.jsx("div",{className:"bg-white rounded-xl shadow-md p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-lg mr-2",children:g(j.severity)}),e.jsx("h4",{className:"font-medium",children:j.type}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${S(j.severity)}`,children:j.severity})]}),j.triggers&&j.triggers.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Triggers:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:j.triggers.map((p,N)=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-xs rounded",children:p},N))})]}),j.notes&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:j.notes}),e.jsx("p",{className:"text-xs text-gray-500",children:y(j.timestamp)})]}),e.jsx("button",{onClick:()=>P(j.id),className:"ml-3 p-1 text-gray-400 hover:text-red-500",children:"🗑️"})]})},j.id))}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Quick Add"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["Sneezing","Runny nose","Itchy eyes","Coughing"].map(j=>e.jsx("button",{onClick:()=>x({type:j,severity:"mild",triggers:[],notes:""}),className:"p-3 border border-gray-200 rounded-lg text-sm hover:bg-gray-50 transition-colors",children:j},j))})]}),t&&a.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"This Week's Patterns"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Most common symptom:"}),e.jsx("span",{className:"font-medium",children:"Sneezing"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Peak time:"}),e.jsx("span",{className:"font-medium",children:"Morning (8-10 AM)"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Common trigger:"}),e.jsx("span",{className:"font-medium",children:"Outdoor exposure"})]})]}),e.jsx("button",{onClick:()=>s("insights"),className:"w-full mt-3 py-2 text-blue-600 text-sm font-medium",children:"View detailed insights →"})]})]})]}),o&&e.jsx(w,{onClose:()=>l(!1),onSave:x})]})}function xr({setScreen:s}){const{user:t}=Pe(),[a,r]=m.useState([]),[o,l]=m.useState(!0),[n,c]=m.useState("all"),[i,d]=m.useState(null);m.useEffect(()=>{u()},[n]);const u=async()=>{try{if(l(!0),t){const p=await q.getUserSubmissions(t.id,n);r(p||[])}else{const p=localStorage.getItem("user_submissions"),N=p?JSON.parse(p):[],h=x(N,n);r(h)}}catch(p){console.error("Failed to load submissions:",p),r([])}finally{l(!1)}},x=(p,N)=>{const h=new Date,b=new Date;switch(N){case"week":b.setDate(h.getDate()-7);break;case"month":b.setMonth(h.getMonth()-1);break;default:return p}return p.filter(f=>new Date(f.created_at)>=b)},P=p=>{const N={very_low:{color:"text-green-600",bg:"bg-green-50",emoji:"🟢"},low:{color:"text-green-600",bg:"bg-green-50",emoji:"🟢"},moderate:{color:"text-yellow-600",bg:"bg-yellow-50",emoji:"🟡"},high:{color:"text-orange-600",bg:"bg-orange-50",emoji:"🟠"},very_high:{color:"text-red-600",bg:"bg-red-50",emoji:"🔴"}};return N[p]||N.moderate},S=p=>{const N=new Date(p),h=new Date,b=Math.floor((h-N)/(1e3*60*60*24));return b===0?"Today":b===1?"Yesterday":b<7?`${b} days ago`:N.toLocaleDateString([],{month:"short",day:"numeric",year:N.getFullYear()!==h.getFullYear()?"numeric":void 0})},g=p=>new Date(p).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),w=(()=>{var k;if(a.length===0)return null;const p=a.reduce((I,v)=>I+(v.pollen_count||0),0),N=Math.round(p/a.length),h=a.reduce((I,v)=>(I[v.pollen_density]=(I[v.pollen_density]||0)+1,I),{}),b=((k=Object.entries(h).sort(([,I],[,v])=>v-I)[0])==null?void 0:k[0])||"moderate",f=a.reduce((I,v)=>I+(v.confidence_score||0),0)/a.length;return{total:a.length,avgCount:N,mostCommonLevel:b,avgConfidence:Math.round(f*100)}})(),j=({submission:p,onClose:N})=>{var b,f;if(!p)return null;const h=P(p.pollen_density);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Submission Details"}),e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[p.image_url&&e.jsx("div",{children:e.jsx("img",{src:p.image_url,alt:"Pollen trap",className:"w-full h-48 object-cover rounded-lg"})}),e.jsxs("div",{className:`p-4 rounded-lg ${h.bg}`,children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-2xl mr-3",children:h.emoji}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold capitalize",children:[p.pollen_density.replace("_"," ")," Level"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[p.pollen_count," grains detected"]})]})]}),e.jsx("p",{className:`text-sm ${h.color}`,children:p.advice||"Pollen level recorded for your area."})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Confidence:"}),e.jsxs("span",{className:"font-medium",children:[Math.round((p.confidence_score||0)*100),"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium",children:new Date(p.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Time:"}),e.jsx("span",{className:"font-medium",children:g(p.created_at)})]})]}),p.location&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:p.location.address||`${(b=p.location.latitude)==null?void 0:b.toFixed(4)}, ${(f=p.location.longitude)==null?void 0:f.toFixed(4)}`})]}),p.weather_conditions&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Weather Conditions"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-medium",children:[p.weather_conditions.temperature,"°C"]}),e.jsx("div",{className:"text-gray-500",children:"Temp"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-medium",children:[p.weather_conditions.humidity,"%"]}),e.jsx("div",{className:"text-gray-500",children:"Humidity"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-medium",children:[p.weather_conditions.wind_speed," km/h"]}),e.jsx("div",{className:"text-gray-500",children:"Wind"})]})]})]}),p.plant_species&&p.plant_species.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Detected Species"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:p.plant_species.map((k,I)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:k},I))})]})]}),e.jsx("button",{onClick:N,className:"w-full mt-6 py-3 bg-blue-600 text-white rounded-lg font-medium",children:"Close"})]})})};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsxs("div",{className:"bg-white shadow-sm p-4 safe-area-top",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>s("home"),className:"mr-3 p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Y,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-semibold",children:"My History"})]}),e.jsx("button",{onClick:()=>s("camera"),className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1 mt-4",children:[{key:"all",label:"All Time"},{key:"month",label:"This Month"},{key:"week",label:"This Week"}].map(({key:p,label:N})=>e.jsx("button",{onClick:()=>c(p),className:`flex-1 py-2 px-3 rounded-md text-sm font-medium transition-colors ${n===p?"bg-white text-blue-600 shadow-sm":"text-gray-600"}`,children:N},p))})]}),e.jsxs("div",{className:"p-4",children:[!t&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-blue-600 mr-3",children:"ℹ️"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-1",children:"Anonymous Mode"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Your submissions are stored locally. Sign in to sync across devices and access full history."})]})]})}),o?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📊"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No submissions yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Start tracking pollen levels to build your history and see trends over time."}),e.jsxs("button",{onClick:()=>s("camera"),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg font-medium",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Submit First Reading"]})]}):e.jsxs("div",{className:"space-y-4",children:[w&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),n==="all"?"All Time":n==="month"?"This Month":"This Week"," Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:w.total}),e.jsx("div",{className:"text-xs text-gray-500",children:"Submissions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-semibold",children:w.avgCount}),e.jsx("div",{className:"text-xs text-gray-500",children:"Avg Grains"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold capitalize",children:w.mostCommonLevel.replace("_"," ")}),e.jsx("div",{className:"text-xs text-gray-500",children:"Most Common"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[w.avgConfidence,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Avg Confidence"})]})]})]}),e.jsx("div",{className:"space-y-3",children:a.map(p=>{var h;const N=P(p.pollen_density);return e.jsx("button",{onClick:()=>d(p),className:"w-full bg-white rounded-xl shadow-md p-4 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx("span",{className:"text-2xl mr-3",children:N.emoji}),e.jsxs("div",{className:"text-left",children:[e.jsxs("h4",{className:"font-medium capitalize",children:[p.pollen_density.replace("_"," ")," Level"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[p.pollen_count," grains • ",Math.round((p.confidence_score||0)*100),"% confidence"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[S(p.created_at)," at ",g(p.created_at)]})]})]}),e.jsxs("div",{className:"text-right",children:[p.location&&e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-1",children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"truncate max-w-20",children:((h=p.location.address)==null?void 0:h.split(",")[0])||"Location"})]}),e.jsx("div",{className:"text-xs text-gray-400",children:"Tap for details"})]})]})},p.id)})}),a.length>=3&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Insights"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Trend:"}),e.jsx("span",{className:"font-medium text-green-600",children:"Improving ↗️"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Best day:"}),e.jsx("span",{className:"font-medium",children:a.filter(p=>p.pollen_density==="low"||p.pollen_density==="very_low").slice(-1)[0]?S(a.filter(p=>p.pollen_density==="low"||p.pollen_density==="very_low").slice(-1)[0].created_at):"No low days yet"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Consistency:"}),e.jsx("span",{className:"font-medium",children:a.length>=7?"Great":"Keep tracking"})]})]}),t&&e.jsx("button",{onClick:()=>s("insights"),className:"w-full mt-3 py-2 text-blue-600 text-sm font-medium",children:"View detailed insights →"})]})]})]}),i&&e.jsx(j,{submission:i,onClose:()=>d(null)})]})}function gr(){var k,I,v,A;const s=oe(),{user:t,signOut:a}=Pe(),{location:r,clearLocation:o,useGoogleGeolocation:l,updateGeolocationPreference:n,isGoogleGeolocationConfigured:c}=ne(),{preferences:i,updatePreferences:d}=Vt(),[u,x]=m.useState(!1),[P,S]=m.useState(!1),[g,y]=m.useState(!1);m.useEffect(()=>{const C=localStorage.getItem("darkMode")==="true";y(C)},[]);const w=()=>{const C=!g;y(C),localStorage.setItem("darkMode",C.toString()),C?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},j=async()=>{try{await a(),s("/")}catch(C){console.error("Sign out error:",C)}},p=()=>{try{const C={submissions:JSON.parse(localStorage.getItem("user_submissions")||"[]"),symptoms:Object.keys(localStorage).filter(R=>R.startsWith("symptoms_")).reduce((R,G)=>(R[G]=JSON.parse(localStorage.getItem(G)||"[]"),R),{}),preferences:i,location:r,exportDate:new Date().toISOString()},E=new Blob([JSON.stringify(C,null,2)],{type:"application/json"}),_=URL.createObjectURL(E),D=document.createElement("a");D.href=_,D.download=`crowdpollen-data-${new Date().toISOString().split("T")[0]}.json`,D.click(),URL.revokeObjectURL(_)}catch(C){console.error("Export failed:",C),alert("Failed to export data")}},N=()=>{try{Object.keys(localStorage).filter(E=>E.startsWith("symptoms_")||E==="user_submissions"||E==="notification_preferences"||E==="user_location").forEach(E=>localStorage.removeItem(E)),o(),x(!1),alert("All data cleared successfully")}catch(C){console.error("Clear data failed:",C),alert("Failed to clear data")}},h=({icon:C,title:E,subtitle:_,action:D,danger:R=!1,showChevron:G=!0})=>e.jsxs("button",{onClick:D,className:`w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors ${R?"text-red-600":"text-gray-900"}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:`w-5 h-5 mr-3 ${R?"text-red-500":"text-gray-500"}`}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:`font-medium ${R?"text-red-600":"text-gray-900"}`,children:E}),_&&e.jsx("p",{className:"text-sm text-gray-500",children:_})]})]}),G&&e.jsx(St,{className:"w-4 h-4 text-gray-400"})]}),b=({icon:C,title:E,subtitle:_,value:D,onChange:R})=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"w-5 h-5 mr-3 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:E}),_&&e.jsx("p",{className:"text-sm text-gray-500",children:_})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:G=>R(G.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"})]})]}),f=({title:C,children:E})=>e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3 px-4",children:C}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-100 overflow-hidden",children:E})]});return e.jsxs("div",{className:"min-h-screen bg-white pb-20",children:[e.jsx("div",{className:"px-6 pt-12 pb-6",children:e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>s("/"),className:"mr-4 p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Y,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Settings"})]})}),e.jsxs("div",{className:"px-6",children:[e.jsx(f,{title:"Account",children:t?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(vt,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.email}),e.jsxs("p",{className:"text-sm text-gray-500",children:[((k=t.user_metadata)==null?void 0:k.account_type)||"Individual"," account"]})]})]})}):e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Sign In"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Coming soon - Sync data across devices"})]}),e.jsx("button",{disabled:!0,className:"px-4 py-2 bg-gray-300 text-gray-500 rounded-lg text-sm font-medium cursor-not-allowed",children:"Coming Soon"})]})})}),e.jsxs(f,{title:"Special Modes",children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Teacher Mode"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Help improve AI model with educational data"})]}),e.jsx("button",{disabled:!0,className:"px-4 py-2 bg-gray-300 text-gray-500 rounded-lg text-sm font-medium cursor-not-allowed",children:"Coming Soon"})]})}),e.jsx("div",{className:"border-t border-gray-100",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Expert Mode"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Review and reclassify AI predictions"})]}),e.jsx("button",{disabled:!0,className:"px-4 py-2 bg-gray-300 text-gray-500 rounded-lg text-sm font-medium cursor-not-allowed",children:"Coming Soon"})]})})})]}),e.jsxs(f,{title:"Notifications",children:[e.jsx(b,{icon:Fe,title:"High Pollen Alerts",subtitle:"Get notified when pollen levels are high",value:i.highPollenAlerts,onChange:C=>d({highPollenAlerts:C})}),e.jsx("div",{className:"border-t border-gray-100",children:e.jsx(b,{icon:Fe,title:"Symptom Reminders",subtitle:"Daily reminders to log symptoms",value:i.symptomReminders,onChange:C=>d({symptomReminders:C})})}),e.jsx("div",{className:"border-t border-gray-100",children:e.jsx(b,{icon:Fe,title:"Weekly Reports",subtitle:"Get weekly summaries",value:i.weeklyReports,onChange:C=>d({weeklyReports:C})})})]}),e.jsx(f,{title:"Location",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-5 h-5 mr-3 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Current Location"}),e.jsx("p",{className:"text-sm text-gray-500",children:r?((I=r.address)==null?void 0:I.split(",")[0])||`${(v=r.latitude)==null?void 0:v.toFixed(4)}, ${(A=r.longitude)==null?void 0:A.toFixed(4)}`:"Not set"})]})]}),e.jsx("button",{onClick:()=>S(!0),className:"text-blue-500 text-sm font-medium hover:text-blue-600 transition-colors",children:r?"Change":"Set"})]})})}),e.jsx(f,{title:"Appearance",children:e.jsx(b,{icon:g?ys:bs,title:"Dark Mode",subtitle:"Use dark theme",value:g,onChange:w})}),e.jsxs(f,{title:"Data & Privacy",children:[e.jsx(h,{icon:wt,title:"Export Data",subtitle:"Download your data",action:p}),e.jsx("div",{className:"border-t border-gray-100",children:e.jsx(h,{icon:js,title:"Privacy Policy",subtitle:"How we protect your data",action:()=>window.open("https://crowdpollen.com/privacy","_blank")})}),e.jsx("div",{className:"border-t border-gray-100",children:e.jsx(h,{icon:Nt,title:"Terms of Service",subtitle:"Terms and conditions",action:()=>window.open("https://crowdpollen.com/terms","_blank")})})]}),e.jsxs(f,{title:"Support",children:[e.jsx(h,{icon:ve,title:"Help & FAQ",subtitle:"Common questions",action:()=>s("/help")}),e.jsx("div",{className:"border-t border-gray-100",children:e.jsx(h,{icon:ve,title:"Contact Support",subtitle:"Get technical help",action:()=>window.open("mailto:support@crowdpollen.com")})})]}),e.jsx(f,{title:"Admin",children:e.jsx(h,{icon:pe,title:"API Settings",subtitle:"Configure and monitor Google APIs",action:()=>s("/api-settings")})}),e.jsxs(f,{title:"Danger Zone",children:[e.jsx(h,{icon:ze,title:"Clear All Data",subtitle:"Permanently delete local data",action:()=>x(!0),danger:!0}),t&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"border-t border-gray-100",children:e.jsx(h,{icon:vs,title:"Sign Out",subtitle:"Sign out of your account",action:j,danger:!0})})})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"CrowdPollen v1.0.0"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Built with ❤️ for citizen science"})]})]}),P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-6 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Set Location"}),e.jsx("button",{onClick:()=>S(!1),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Y,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx(Xe,{onLocationSet:()=>S(!1),showTitle:!1})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-6 z-50",children:e.jsx("div",{className:"bg-white rounded-2xl p-6 max-w-sm w-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ze,{className:"w-8 h-8 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Clear All Data?"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"This will permanently delete all your submissions, symptoms, and settings. This action cannot be undone."}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>x(!1),className:"flex-1 py-3 border border-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:N,className:"flex-1 py-3 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600 transition-colors",children:"Delete All"})]})]})})})]})}const Xt=30*60*1e3,pr=6*60*60*1e3,me=new Map,es=(s,t,a="current")=>{const r=Math.round(s*1e3)/1e3,o=Math.round(t*1e3)/1e3;return`weather_${a}_${r}_${o}`},et=(s,t=Xt)=>s&&Date.now()-s.timestamp<t,fr=async(s,t,a="metric")=>{if(!s||!t)throw new Error("Latitude and longitude are required");const r=es(s,t,"current"),o=me.get(r);if(et(o,Xt))return console.log("Returning cached current weather data"),o.data;try{return yt(s,t)}catch(l){return console.error("Failed to fetch current weather:",l),yt(s,t)}},yr=async(s,t,a=5,r="metric")=>{if(!s||!t)throw new Error("Latitude and longitude are required");const o=es(s,t,`forecast_${a}`),l=me.get(o);if(et(l,pr))return console.log("Returning cached weather forecast data"),l.data;try{return bt(s,t,a)}catch(n){return console.error("Failed to fetch weather forecast:",n),bt(s,t,a)}},br=(s,t)=>{var o,l,n,c,i,d,u,x,P,S,g,y,w,j,p,N,h,b;const a=t==="metric"?"°C":"°F",r=t==="metric"?"m/s":"mph";return{location:{name:s.name,country:(o=s.sys)==null?void 0:o.country,coordinates:{latitude:(l=s.coord)==null?void 0:l.lat,longitude:(n=s.coord)==null?void 0:n.lon}},current:{temperature:Math.round(((c=s.main)==null?void 0:c.temp)||0),temperatureUnit:a,feelsLike:Math.round(((i=s.main)==null?void 0:i.feels_like)||0),humidity:((d=s.main)==null?void 0:d.humidity)||0,pressure:((u=s.main)==null?void 0:u.pressure)||0,visibility:s.visibility?Math.round(s.visibility/1e3):null,uvIndex:null,windSpeed:((x=s.wind)==null?void 0:x.speed)||0,windDirection:((P=s.wind)==null?void 0:P.deg)||0,windUnit:r,cloudCover:((S=s.clouds)==null?void 0:S.all)||0,condition:{main:((y=(g=s.weather)==null?void 0:g[0])==null?void 0:y.main)||"Unknown",description:((j=(w=s.weather)==null?void 0:w[0])==null?void 0:j.description)||"Unknown",icon:((N=(p=s.weather)==null?void 0:p[0])==null?void 0:N.icon)||"01d"},sunrise:(h=s.sys)!=null&&h.sunrise?new Date(s.sys.sunrise*1e3).toISOString():null,sunset:(b=s.sys)!=null&&b.sunset?new Date(s.sys.sunset*1e3).toISOString():null},metadata:{fetchedAt:new Date().toISOString(),source:"openweathermap",units:t}}},jr=(s,t,a)=>{var n,c,i,d,u,x,P;const r=t==="metric"?"°C":"°F",o=[],l={};return(n=s.list)==null||n.forEach(S=>{const g=new Date(S.dt*1e3).toISOString().split("T")[0];l[g]||(l[g]=[]),l[g].push(S)}),Object.entries(l).slice(0,a).forEach(([S,g])=>{const y=g.map(h=>h.main.temp),w=g.map(h=>h.weather[0]),j={};w.forEach(h=>{j[h.main]=(j[h.main]||0)+1});const p=Object.entries(j).sort(([,h],[,b])=>b-h)[0][0],N=w.find(h=>h.main===p);o.push({date:S,temperature:{min:Math.round(Math.min(...y)),max:Math.round(Math.max(...y)),unit:r},condition:{main:N.main,description:N.description,icon:N.icon},humidity:Math.round(g.reduce((h,b)=>h+b.main.humidity,0)/g.length),windSpeed:Math.round(g.reduce((h,b)=>{var f;return h+(((f=b.wind)==null?void 0:f.speed)||0)},0)/g.length),cloudCover:Math.round(g.reduce((h,b)=>{var f;return h+(((f=b.clouds)==null?void 0:f.all)||0)},0)/g.length),precipitation:g.some(h=>h.rain||h.snow)})}),{location:{name:(c=s.city)==null?void 0:c.name,country:(i=s.city)==null?void 0:i.country,coordinates:{latitude:(u=(d=s.city)==null?void 0:d.coord)==null?void 0:u.lat,longitude:(P=(x=s.city)==null?void 0:x.coord)==null?void 0:P.lon}},dailyForecasts:o,metadata:{fetchedAt:new Date().toISOString(),source:"openweathermap",units:t,forecastDays:a}}},yt=(s,t)=>{const a=[{main:"Clear",description:"clear sky",icon:"01d"},{main:"Clouds",description:"few clouds",icon:"02d"},{main:"Clouds",description:"scattered clouds",icon:"03d"},{main:"Rain",description:"light rain",icon:"10d"}],r=a[Math.floor(Math.random()*a.length)],o=Math.round(15+Math.random()*20);return{location:{name:"Mock Location",country:"US",coordinates:{latitude:s,longitude:t}},current:{temperature:o,temperatureUnit:"°C",feelsLike:o+Math.round((Math.random()-.5)*4),humidity:Math.round(40+Math.random()*40),pressure:Math.round(1e3+Math.random()*50),visibility:Math.round(5+Math.random()*15),uvIndex:Math.round(Math.random()*11),windSpeed:Math.round(Math.random()*20),windDirection:Math.round(Math.random()*360),windUnit:"m/s",cloudCover:Math.round(Math.random()*100),condition:r,sunrise:new Date(Date.now()-6*60*60*1e3).toISOString(),sunset:new Date(Date.now()+6*60*60*1e3).toISOString()},metadata:{fetchedAt:new Date().toISOString(),source:"mock_data",units:"metric"}}},bt=(s,t,a)=>{const r=[{main:"Clear",description:"clear sky",icon:"01d"},{main:"Clouds",description:"few clouds",icon:"02d"},{main:"Rain",description:"light rain",icon:"10d"}],o=[];for(let l=0;l<a;l++){const n=new Date;n.setDate(n.getDate()+l);const c=r[Math.floor(Math.random()*r.length)],i=20+Math.random()*15;o.push({date:n.toISOString().split("T")[0],temperature:{min:Math.round(i-5),max:Math.round(i+5),unit:"°C"},condition:c,humidity:Math.round(40+Math.random()*40),windSpeed:Math.round(Math.random()*15),cloudCover:Math.round(Math.random()*100),precipitation:Math.random()>.7})}return{location:{name:"Mock Location",country:"US",coordinates:{latitude:s,longitude:t}},dailyForecasts:o,metadata:{fetchedAt:new Date().toISOString(),source:"mock_data",units:"metric",forecastDays:a}}},vr=(s,t)=>{const a=t==null?void 0:t.includes("d");switch(s==null?void 0:s.toLowerCase()){case"clear":return a?"☀️":"🌙";case"clouds":return a?"⛅":"☁️";case"rain":return"🌧️";case"drizzle":return"🌦️";case"thunderstorm":return"⛈️";case"snow":return"❄️";case"mist":case"fog":return"🌫️";default:return a?"🌤️":"🌙"}},wr=()=>!0,Nr=()=>{me.clear(),console.log("Weather cache cleared")},Sr=()=>{let s=0,t=0;for(const[a,r]of me.entries())et(r)?s++:t++;return{totalEntries:me.size,validEntries:s,expiredEntries:t}},jt={getCurrentWeather:fr,getWeatherForecast:yr,getWeatherEmoji:vr,isConfigured:wr,clearCache:Nr,getCacheStats:Sr},Cr=async()=>{var t,a,r,o,l,n,c,i;const s={timestamp:new Date().toISOString(),services:{}};try{const d=F.isConfigured();if(s.services.googleMaps={configured:d,status:d?"ready":"needs_api_key",message:d?"Google Maps API key found":"Add VITE_GOOGLE_MAPS_API_KEY to .env file"},d)try{const u=await F.geocodeAddress("New York, NY");s.services.googleMaps.geocoding="working",s.services.googleMaps.testLocation=u}catch(u){s.services.googleMaps.geocoding="error",s.services.googleMaps.error=u.message}}catch(d){s.services.googleMaps={configured:!1,status:"error",error:d.message}}try{const d="AIzaSyB_Fj3F0vAmvCNBGMGIN90fQtk85cuxj1s";s.services.googlePollen={configured:!!d,status:d?"ready":"using_mock_data",message:d?"Google Pollen API key found":"Using mock data - add VITE_GOOGLE_MAPS_API_KEY for real data"};try{const u=await H.getForecast(40.7128,-74.006,3);s.services.googlePollen.forecast="working",s.services.googlePollen.dataSource=((t=u.metadata)==null?void 0:t.source)||"unknown",s.services.googlePollen.sampleData={days:((a=u.dailyForecasts)==null?void 0:a.length)||0,firstDay:(o=(r=u.dailyForecasts)==null?void 0:r[0])==null?void 0:o.date}}catch(u){s.services.googlePollen.forecast="error",s.services.googlePollen.error=u.message}}catch(d){s.services.googlePollen={configured:!1,status:"error",error:d.message}}try{const d=jt.isConfigured();s.services.googleWeather={configured:d,status:d?"ready":"using_mock_data",message:d?"Weather API configured":"Using mock data - add VITE_OPENWEATHER_API_KEY for real weather"};try{const u=await jt.getCurrentWeather(40.7128,-74.006);s.services.googleWeather.current="working",s.services.googleWeather.dataSource=((l=u.metadata)==null?void 0:l.source)||"unknown",s.services.googleWeather.sampleData={temperature:(n=u.current)==null?void 0:n.temperature,condition:(i=(c=u.current)==null?void 0:c.condition)==null?void 0:i.main}}catch(u){s.services.googleWeather.current="error",s.services.googleWeather.error=u.message}}catch(d){s.services.googleWeather={configured:!1,status:"error",error:d.message}}try{const{default:d}=await ye(async()=>{const{default:x}=await Promise.resolve().then(()=>Ma);return{default:x}},void 0),u=d.isConfigured();s.services.googleGeolocation={configured:u,status:u?"ready":"needs_api_key",message:u?"Google Geolocation API configured ($5 per 1,000 requests)":"Add VITE_GOOGLE_MAPS_API_KEY to enable geolocation without GPS"},u&&(s.services.googleGeolocation.note="API ready - test manually to avoid charges")}catch(d){s.services.googleGeolocation={configured:!1,status:"error",error:d.message}}return s},kr=()=>{const s={required:[],optional:[],status:"complete"};return s.optional.push({service:"Hugging Face",key:"VITE_HUGGINGFACE_API_TOKEN",description:"AI pollen detection from photos",priority:"medium"}),s},Pr=()=>`# CrowdPollen - Simplified 3-Provider Setup
# Copy this to .env and add your API keys

# 1️⃣ SUPABASE (Required for database & auth)
VITE_SUPABASE_URL=your_supabase_project_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key

# 2️⃣ GOOGLE CLOUD (Required for maps, pollen & weather)
VITE_GOOGLE_MAPS_API_KEY=your_google_cloud_api_key

# 3️⃣ HUGGING FACE (Optional - for AI pollen detection)
VITE_HUGGINGFACE_API_TOKEN=your_huggingface_token

# 🔧 App Configuration
VITE_APP_ENV=development
VITE_ENABLE_ANALYTICS=false
`,Ar=()=>{const{useGoogleGeolocation:s,updateGeolocationPreference:t,isGoogleGeolocationConfigured:a}=ne(),[r,o]=m.useState(null),[l,n]=m.useState(!1),[c,i]=m.useState(null),[d,u]=m.useState(!1);m.useEffect(()=>{const g=kr();i(g)},[]);const x=async()=>{n(!0);try{const g=await Cr();o(g)}catch(g){console.error("Test failed:",g),o({error:g.message,timestamp:new Date().toISOString()})}finally{n(!1)}},P=g=>{switch(g){case"ready":return"text-green-600 bg-green-50";case"working":return"text-green-600 bg-green-50";case"using_mock_data":return"text-yellow-600 bg-yellow-50";case"needs_api_key":return"text-orange-600 bg-orange-50";case"error":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},S=g=>{switch(g){case"ready":return"✅";case"working":return"✅";case"using_mock_data":return"🔄";case"needs_api_key":return"⚠️";case"error":return"❌";default:return"❓"}};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"🧪 CrowdPollen API Test Panel"}),e.jsx("p",{className:"text-gray-600",children:"Test your API configuration and see what's working"})]}),c&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:["📋 Setup Status: ",c.status==="complete"?"✅ Complete":"⚠️ Incomplete"]}),c.required.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-red-700 mb-2",children:"Required API Keys Missing:"}),e.jsx("ul",{className:"space-y-1",children:c.required.map((g,y)=>e.jsxs("li",{className:"text-sm text-red-600",children:["• ",e.jsx("code",{className:"bg-red-100 px-1 rounded",children:g.key})," - ",g.description]},y))})]}),c.optional.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-yellow-700 mb-2",children:"Optional API Keys (using fallbacks):"}),e.jsx("ul",{className:"space-y-1",children:c.optional.map((g,y)=>e.jsxs("li",{className:"text-sm text-yellow-600",children:["• ",e.jsx("code",{className:"bg-yellow-100 px-1 rounded",children:g.key})," - ",g.description]},y))})]}),e.jsxs("button",{onClick:()=>u(!d),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:[d?"Hide":"Show"," .env Template"]}),d&&e.jsx("div",{className:"mt-3",children:e.jsx("pre",{className:"bg-gray-900 text-green-400 p-3 rounded text-xs overflow-x-auto",children:Pr()})})]}),a&&e.jsxs("div",{className:"mb-6 p-4 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-900 mb-3",children:"🔧 Admin Controls"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-orange-800",children:"Google Geolocation Service"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Enable location without GPS ($5 per 1,000 requests)"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:g=>t(g.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:x,disabled:l,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-300 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:l?"🔄 Testing APIs...":"🧪 Test All APIs"})}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Test Results"}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(r.timestamp).toLocaleString()})]}),r.error?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700",children:["❌ Test failed: ",r.error]})}):e.jsx("div",{className:"grid gap-4",children:Object.entries(r.services).map(([g,y])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 capitalize",children:g.replace(/([A-Z])/g," $1").trim()}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${P(y.status)}`,children:[S(y.status)," ",y.status.replace(/_/g," ")]})]}),e.jsx("p",{className:"text-gray-600 mb-3",children:y.message}),y.configured!==void 0&&e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["API Key: ",y.configured?"✅ Found":"❌ Missing"]}),y.dataSource&&e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["Data Source: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:y.dataSource})]}),y.sampleData&&e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["Sample Data: ",JSON.stringify(y.sampleData,null,2)]}),y.testLocation&&e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["Test Location: ",y.testLocation.address,"(",y.testLocation.latitude,", ",y.testLocation.longitude,")"]}),y.error&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:["Error: ",y.error]}),g==="googleMaps"&&y.geocoding&&e.jsxs("div",{className:"text-sm text-green-600",children:["✅ Geocoding: ",y.geocoding]}),g==="googlePollen"&&y.forecast&&e.jsxs("div",{className:"text-sm text-green-600",children:["✅ Forecast: ",y.forecast]}),g==="googleWeather"&&y.current&&e.jsxs("div",{className:"text-sm text-green-600",children:["✅ Current Weather: ",y.current]})]},g))})]}),e.jsxs("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"🚀 Quick Setup"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"1. Copy .env.example to .env:"})," ",e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"cp .env.example .env"})]}),e.jsx("p",{children:e.jsx("strong",{children:"2. Add your API keys to .env file"})}),e.jsxs("p",{children:[e.jsx("strong",{children:"3. Restart the development server:"})," ",e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"npm run dev"})]}),e.jsx("p",{children:e.jsx("strong",{children:'4. Click "Test All APIs" to verify setup'})})]})]})]})};function Ir(){const[s,t]=m.useState({}),[a,r]=m.useState({}),[o,l]=m.useState({totalMonthlyCost:0,breakdown:[]}),[n,c]=m.useState([]),[i,d]=m.useState(!0),[u,x]=m.useState(Date.now());m.useEffect(()=>{P()},[]);const P=()=>{d(!0);try{t(U.getTodayStats()),r(U.getWeeklyStats()),l(U.estimateMonthlyCost()),c(U.getRecentErrors(24)),x(Date.now())}catch(v){console.error("Error loading monitoring data:",v)}finally{d(!1)}},S=()=>{try{const v=U.exportData(),A=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),C=URL.createObjectURL(A),E=document.createElement("a");E.href=C,E.download=`api-monitoring-${new Date().toISOString().split("T")[0]}.json`,E.click(),URL.revokeObjectURL(C)}catch(v){console.error("Export failed:",v),alert("Failed to export monitoring data")}},g=()=>{confirm("Are you sure you want to clear all API monitoring data? This cannot be undone.")&&(U.clearAllData()?(P(),alert("API monitoring data cleared successfully")):alert("Failed to clear monitoring data"))},y=v=>{switch(v){case"google-pollen":return"🌸";case"google-maps":return"🗺️";case"google-geolocation":return"📍";case"google-weather":return"🌤️";default:return"🔧"}},w=v=>{switch(v){case"google-pollen":return"text-pink-600 bg-pink-50";case"google-maps":return"text-blue-600 bg-blue-50";case"google-geolocation":return"text-orange-600 bg-orange-50";case"google-weather":return"text-green-600 bg-green-50";default:return"text-gray-600 bg-gray-50"}},j=v=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:4}).format(v),p=v=>new Date(v).toLocaleTimeString(),N=({title:v,value:A,subtitle:C,icon:E,color:_="text-blue-600 bg-blue-50"})=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:v}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:A}),C&&e.jsx("p",{className:"text-sm text-gray-500",children:C})]}),e.jsx("div",{className:`p-3 rounded-lg ${_}`,children:e.jsx(E,{className:"w-6 h-6"})})]})}),h=({service:v,data:A,isWeekly:C=!1})=>{const E=A.total>0?(A.success/A.total*100).toFixed(1):"0",_=C?(A.total/Math.max(A.days||1,1)).toFixed(1):null;return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl mr-2",children:y(v)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 capitalize",children:v.replace("google-","").replace("-"," ")}),e.jsx("p",{className:"text-sm text-gray-500",children:C?`${A.days||0} days`:"Today"})]})]}),e.jsxs("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${w(v)}`,children:[E,"% success"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Total Requests"}),e.jsx("p",{className:"font-semibold text-gray-900",children:A.total})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Errors"}),e.jsx("p",{className:"font-semibold text-red-600",children:A.errors})]}),_&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Avg/Day"}),e.jsx("p",{className:"font-semibold text-gray-900",children:_})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Cost"}),e.jsx("p",{className:"font-semibold text-green-600",children:j(A.totalCost)})]})]})]})};if(i)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(We,{className:"w-6 h-6 animate-spin text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-500",children:"Loading monitoring data..."})]})});const b=Object.values(s).reduce((v,A)=>v+A.total,0),f=Object.values(s).reduce((v,A)=>v+A.errors,0),k=Object.values(s).reduce((v,A)=>v+A.totalCost,0),I=b>0?((b-f)/b*100).toFixed(1):"100";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(Ee,{className:"w-6 h-6 mr-2 text-blue-600"}),"API Monitoring Dashboard"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Last updated: ",p(u)]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:P,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[e.jsx(We,{className:"w-4 h-4 mr-1"}),"Refresh"]}),e.jsxs("button",{onClick:S,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[e.jsx(wt,{className:"w-4 h-4 mr-1"}),"Export"]}),e.jsxs("button",{onClick:g,className:"px-3 py-2 text-sm border border-red-200 text-red-600 rounded-lg hover:bg-red-50 transition-colors flex items-center",children:[e.jsx(ze,{className:"w-4 h-4 mr-1"}),"Clear"]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Today's Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(N,{title:"Total Requests",value:b,icon:He,color:"text-blue-600 bg-blue-50"}),e.jsx(N,{title:"Success Rate",value:`${I}%`,icon:fe,color:"text-green-600 bg-green-50"}),e.jsx(N,{title:"Errors",value:f,icon:je,color:"text-red-600 bg-red-50"}),e.jsx(N,{title:"Cost Today",value:j(k),icon:ot,color:"text-green-600 bg-green-50"})]}),Object.keys(s).length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(s).map(([v,A])=>e.jsx(h,{service:v,data:A},v))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Weekly Overview"}),Object.keys(a).length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(a).map(([v,A])=>e.jsx(h,{service:v,data:A,isWeekly:!0},v))}):e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[e.jsx(Ee,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No weekly data available yet"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Monthly Cost Estimate"}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:j(o.totalMonthlyCost)}),e.jsx("p",{className:"text-sm text-gray-500",children:"Estimated monthly cost"})]}),e.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:e.jsx(ot,{className:"w-6 h-6 text-green-600"})})]}),o.breakdown.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-700",children:"Breakdown by Service"}),o.breakdown.map(v=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-lg mr-2",children:y(v.service)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:v.serviceName}),e.jsxs("p",{className:"text-sm text-gray-500",children:[v.avgDailyRequests,"/day avg • ",j(v.costPerRequest),"/request"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:j(v.monthlyCost)}),e.jsxs("p",{className:"text-sm text-gray-500",children:[v.monthlyRequests," req/month"]})]})]},v.service))]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Recent Errors (24h)"}),n.length>0?e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"divide-y divide-gray-200",children:n.slice(0,10).map((v,A)=>e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-50 rounded-lg mr-3",children:e.jsx(je,{className:"w-4 h-4 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 capitalize",children:v.service.replace("google-","").replace("-"," ")}),e.jsx("p",{className:"text-sm text-gray-500",children:p(v.timestamp)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-red-600",children:[v.errors," errors"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[v.errorRate,"% error rate"]})]})]},A))})}):e.jsxs("div",{className:"bg-green-50 rounded-lg p-8 text-center",children:[e.jsx(fe,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-green-700 font-medium",children:"No errors in the last 24 hours!"}),e.jsx("p",{className:"text-green-600 text-sm",children:"All APIs are running smoothly"})]})]})]})}function _r(){const s=oe(),{useGoogleGeolocation:t,updateGeolocationPreference:a,isGoogleGeolocationConfigured:r}=ne(),[o,l]=m.useState("testing");return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm p-4 safe-area-top",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>s("/"),className:"mr-3 p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Y,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"w-6 h-6 text-blue-600 mr-2"}),e.jsx("h1",{className:"text-xl font-semibold",children:"API Settings"})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-1",children:"🌸 New to CrowdPollen?"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Take a quick tour to learn about all features and how to use the app effectively."})]}),e.jsx("button",{onClick:()=>s("/walkthrough"),className:"px-4 py-2 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-lg font-medium hover:from-green-600 hover:to-blue-600 transition-colors shadow-md",children:"Take Tour"})]})}),r&&e.jsxs("div",{className:"mb-6 p-4 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-900 mb-3",children:"🔧 Admin Controls"}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-orange-800",children:"Google Geolocation Service"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Enable location without GPS ($5 per 1,000 requests)"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:n=>a(n.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"})]})]}),e.jsxs("div",{className:"bg-orange-100 rounded-lg p-3 text-sm",children:[e.jsx("h5",{className:"font-medium text-orange-900 mb-2",children:"💰 Built-in Cost Protection"}),e.jsxs("ul",{className:"text-orange-800 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Rate Limiting:"})," Max 10 requests per hour"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Time Throttling:"})," 5-minute minimum between calls"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Distance Filtering:"})," Only updates if moved 100+ meters"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Smart Caching:"})," Reuses recent location data"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Fallback Logic:"})," Uses free GPS when rate limited"]})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>l("testing"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors flex items-center justify-center ${o==="testing"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"API Testing"]}),e.jsxs("button",{onClick:()=>l("monitoring"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors flex items-center justify-center ${o==="monitoring"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"API Monitoring"]})]})}),o==="testing"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx(Ar,{})}),o==="monitoring"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:e.jsx(Ir,{})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"🔗 Direct Access"}),e.jsx("p",{className:"text-sm text-blue-700 mb-2",children:"You can access this page directly at:"}),e.jsxs("code",{className:"text-sm bg-blue-100 px-2 py-1 rounded text-blue-800",children:[window.location.origin,"/api-settings"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"Bookmark this URL for quick access to API configuration and monitoring"})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>s("/settings"),className:"p-4 bg-white rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"text-center",children:[e.jsx(pe,{className:"w-6 h-6 text-gray-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"User Settings"}),e.jsx("div",{className:"text-xs text-gray-500",children:"General app settings"})]})}),e.jsx("button",{onClick:()=>s("/"),className:"p-4 bg-white rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Nt,{className:"w-6 h-6 text-gray-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Home"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Back to main app"})]})})]})]})]})}function Mr(){const s=oe(),[t,a]=m.useState(0),r=[{title:"Welcome to CrowdPollen! 🌸",icon:Ie,content:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("span",{className:"text-3xl",children:"🌸"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Track Pollen Like a Pro"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"CrowdPollen combines professional weather data with community reports to give you the most accurate pollen information available."}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"What makes us different?"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Real-time community data + Google's professional forecasts"}),e.jsx("li",{children:"• 5-day pollen forecasts with health recommendations"}),e.jsx("li",{children:"• Photo-based pollen trap submissions"}),e.jsx("li",{children:"• Symptom tracking and personalized insights"})]})]})]})},{title:"Home Screen - Your Dashboard 🏠",icon:Ie,content:e.jsxs("div",{children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ie,{className:"w-8 h-8 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"Your Pollen Command Center"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"📊 5-Day Forecast Widget"}),e.jsx("p",{className:"text-sm text-gray-600",children:"See professional pollen forecasts powered by Google's API. Click any day to see detailed breakdowns by pollen type (tree, grass, weed)."})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"📍 Location-Based Data"}),e.jsx("p",{className:"text-sm text-gray-600",children:"All forecasts are tailored to your specific location. Set it once and get hyper-local pollen information."})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"🎯 Quick Actions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Jump straight to camera for pollen trap photos, check the map, or log symptoms - all from your home screen."})]})]})]})},{title:"Camera - Capture Pollen Evidence 📸",icon:ee,content:e.jsxs("div",{children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ee,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"Document Real Pollen Levels"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"📱 Pollen Trap Photos"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Take photos of surfaces covered in pollen - car hoods, outdoor furniture, anything that shows pollen accumulation."}),e.jsx("div",{className:"text-xs text-blue-600 bg-blue-50 p-2 rounded",children:"💡 Tip: Best photos are taken in good lighting with clear pollen visibility"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"🏷️ Smart Categorization"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Rate pollen levels (Low/Medium/High) and specify types (Tree/Grass/Weed) to help the community."})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"🌍 Automatic Location"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Your submissions are automatically tagged with location and timestamp for accurate community mapping."})]})]})]})},{title:"Pollen Trap Guide - DIY Collection 🪤",icon:ve,content:e.jsxs("div",{children:[e.jsx("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ve,{className:"w-8 h-8 text-yellow-600"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"Make Your Own Pollen Trap"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-blue-800",children:"⏱️ Time needed:"}),e.jsx("span",{className:"text-blue-700",children:"5 minutes"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"font-medium text-blue-800",children:"🕐 Best exposure:"}),e.jsx("span",{className:"text-blue-700",children:"1-3 hours (up to 24h)"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"🛠️ What you need:"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("p",{children:"• Clear tape or petroleum jelly"}),e.jsx("p",{children:"• Small plate or cardboard"}),e.jsx("p",{children:"• Magnifying glass (optional)"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"📋 Quick Steps:"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("p",{children:"1. Apply tape sticky-side up or spread petroleum jelly"}),e.jsx("p",{children:"2. Place in open area away from buildings"}),e.jsx("p",{children:"3. Wait 1-3 hours (best on dry, breezy days)"}),e.jsx("p",{children:"4. Photograph with CrowdPollen app"})]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-green-800",children:[e.jsx("span",{className:"font-medium",children:"💡 Remember:"})," This guide is always available on the submit page whenever you need it!"]})})]})]})},{title:"Map - Community Intelligence 🗺️",icon:Me,content:e.jsxs("div",{children:[e.jsx("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Me,{className:"w-8 h-8 text-purple-600"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"See Pollen Everywhere"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"🎨 Dual-Layer Visualization"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Professional forecast heatmaps overlay with real community submissions. Toggle between layers to see both perspectives."})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"📍 Interactive Markers"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click any community submission to see photos, pollen levels, and submission details from other users."})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"🔍 Zoom & Explore"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Zoom into your neighborhood or explore other regions. Perfect for planning trips or understanding regional patterns."})]})]})]})},{title:"Symptoms - Track Your Health 🤧",icon:He,content:e.jsxs("div",{children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(He,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"Monitor Your Reactions"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"📝 Daily Symptom Logging"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Track sneezing, congestion, itchy eyes, and more. Rate severity and add notes about triggers or medications."})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"📊 Pattern Recognition"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Correlate your symptoms with pollen forecasts to identify your personal triggers and peak sensitivity times."})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"💊 Medication Tracking"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Log when you take allergy medications to see effectiveness and optimize your treatment timing."})]})]})]})},{title:"History - Your Personal Data 📈",icon:nt,content:e.jsxs("div",{children:[e.jsx("div",{className:"w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(nt,{className:"w-8 h-8 text-orange-600"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"Learn From Your Data"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"📸 Submission Gallery"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Browse all your pollen trap photos with timestamps and locations. See how pollen levels changed over time."})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"📊 Symptom Trends"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visualize your symptom patterns over weeks and months. Identify seasonal trends and trigger patterns."})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"📤 Data Export"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Export your data for sharing with healthcare providers or personal analysis. Your data, your control."})]})]})]})},{title:"Settings - Customize Your Experience ⚙️",icon:pe,content:e.jsxs("div",{children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(pe,{className:"w-8 h-8 text-gray-600"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"Make It Yours"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"🔔 Smart Notifications"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Get alerts for high pollen days, symptom logging reminders, and weekly health reports."})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"📍 Location Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Set your home location for accurate forecasts. Use GPS or enter ZIP codes for multiple locations."})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"🔐 Privacy Controls"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Control data sharing, export your information, and manage account preferences. Your privacy matters."})]})]})]})},{title:"Ready to Start! 🚀",icon:lt,content:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(lt,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"You're All Set!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You now know how to use all of CrowdPollen's features. Start by setting your location, then explore the forecast and begin contributing to the community!"}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"🎯 Quick Start Checklist"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 rounded mr-3"}),e.jsx("span",{children:"Set your location in Settings"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 rounded mr-3"}),e.jsx("span",{children:"Check today's pollen forecast"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 rounded mr-3"}),e.jsx("span",{children:"Take your first pollen trap photo"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 rounded mr-3"}),e.jsx("span",{children:"Log any current symptoms"})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>s("/api-settings"),className:"flex-1 py-3 border border-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors",children:"API Settings"}),e.jsx("button",{onClick:()=>s("/"),className:"flex-1 py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl font-medium hover:from-green-600 hover:to-blue-600 transition-colors",children:"Start Using CrowdPollen"})]})]})}],o=()=>{t<r.length-1&&a(t+1)},l=()=>{t>0&&a(t-1)},n=r[t];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-green-50 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm p-4 safe-area-top",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>s("/api-settings"),className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"text-sm",children:"Back to API Settings"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t+1," of ",r.length]})]})}),e.jsx("div",{className:"px-6 py-4",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${(t+1)/r.length*100}%`}})})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6 min-h-[500px]",children:n.content}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("button",{onClick:l,disabled:t===0,className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${t===0?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-white hover:shadow-md"}`,children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Previous"]}),e.jsx("div",{className:"flex space-x-2",children:r.map((c,i)=>e.jsx("button",{onClick:()=>a(i),className:`w-3 h-3 rounded-full transition-colors ${i===t?"bg-blue-500":i<t?"bg-green-500":"bg-gray-300"}`},i))}),e.jsxs("button",{onClick:o,disabled:t===r.length-1,className:`flex items-center px-4 py-2 rounded-lg font-medium transition-colors ${t===r.length-1?"text-gray-400 cursor-not-allowed":"text-white bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 shadow-md"}`,children:["Next",e.jsx(ws,{className:"w-4 h-4 ml-2"})]})]})]})})]})}function Er({onComplete:s}){const[t,a]=m.useState(0),r=[{title:"Welcome to CrowdPollen",subtitle:"Help track pollen levels in your community",icon:"🌻",content:"Join thousands of citizen scientists collecting real-time pollen data to help everyone manage their allergies better."},{title:"Take Photos",subtitle:"Capture pollen trap images",icon:ee,content:"Use your phone's camera to photograph pollen traps. Our AI will analyze the images to count pollen grains."},{title:"Share Location",subtitle:"Help map pollen levels",icon:V,content:"Share your location to contribute to neighborhood pollen maps. You can use GPS or enter your ZIP code."},{title:"Track Symptoms",subtitle:"Monitor your health",icon:Ee,content:"Log your allergy symptoms to see how they correlate with local pollen levels and get personalized insights."}],o=()=>{t<r.length-1?a(t+1):s()},l=()=>{s()},n=r[t],c=n.icon;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-500 to-blue-600 flex flex-col",children:[e.jsx("div",{className:"flex justify-end p-4 safe-area-top",children:e.jsx("button",{onClick:l,className:"text-white/80 hover:text-white text-sm font-medium",children:"Skip"})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 text-center text-white",children:[e.jsx("div",{className:"mb-8",children:typeof c=="string"?e.jsx("div",{className:"text-6xl",children:c}):e.jsx("div",{className:"w-20 h-20 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(c,{className:"w-10 h-10"})})}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:n.title}),e.jsx("h2",{className:"text-xl font-medium mb-6 opacity-90",children:n.subtitle}),e.jsx("p",{className:"text-lg opacity-80 leading-relaxed max-w-sm",children:n.content})]}),e.jsxs("div",{className:"p-6 safe-area-bottom",children:[e.jsx("div",{className:"flex justify-center mb-8",children:r.map((i,d)=>e.jsx("div",{className:`w-2 h-2 rounded-full mx-1 transition-colors ${d===t?"bg-white":"bg-white/30"}`},d))}),e.jsxs("button",{onClick:o,className:"w-full bg-white text-blue-600 py-4 rounded-xl font-semibold text-lg flex items-center justify-center hover:bg-gray-50 transition-colors",children:[t<r.length-1?"Next":"Get Started",e.jsx(St,{className:"w-5 h-5 ml-2"})]})]})]})}function Tr(){return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-500 to-blue-600 flex flex-col items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"text-6xl mb-6",children:"🌻"}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"CrowdPollen"}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),e.jsx("p",{className:"text-white/80",children:"Loading..."})]})})}class Lr extends m.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,a){this.setState({error:t,errorInfo:a})}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"😵"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Oops! Something went wrong"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"We're sorry, but something unexpected happened. Please try refreshing the page."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Refresh Page"}),!1]})}):this.props.children}}function Dr(){const[s,t]=m.useState(!0),[a,r]=m.useState(!1);m.useEffect(()=>{setTimeout(()=>{const n=localStorage.getItem("crowdpollen_onboarding_completed");r(!!n),t(!1)},1e3)},[]);const o=()=>{localStorage.setItem("crowdpollen_onboarding_completed","true"),r(!0)};return s?e.jsx(Tr,{}):a?e.jsx(Lr,{children:e.jsx(wa,{future:{v7_relativeSplatPath:!0},children:e.jsx(Aa,{children:e.jsx(Ea,{children:e.jsx(Ta,{children:e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsx("main",{className:"pb-16 safe-bottom",children:e.jsxs(ba,{children:[e.jsx(Z,{path:"/",element:e.jsx(nr,{})}),e.jsx(Z,{path:"/camera",element:e.jsx(dr,{})}),e.jsx(Z,{path:"/map",element:e.jsx(ur,{})}),e.jsx(Z,{path:"/symptoms",element:e.jsx(hr,{})}),e.jsx(Z,{path:"/history",element:e.jsx(xr,{})}),e.jsx(Z,{path:"/settings",element:e.jsx(gr,{})}),e.jsx(Z,{path:"/api-settings",element:e.jsx(_r,{})}),e.jsx(Z,{path:"/walkthrough",element:e.jsx(Mr,{})}),e.jsx(Z,{path:"*",element:e.jsx(fa,{to:"/",replace:!0})})]})}),e.jsx(Ra,{})]})})})})})}):e.jsx(Er,{onComplete:o})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(s=>{console.log("SW registered: ",s)}).catch(s=>{console.log("SW registration failed: ",s)})});Be.createRoot(document.getElementById("root")).render(e.jsx(rs.StrictMode,{children:e.jsx(Dr,{})}));
//# sourceMappingURL=index-DtyphV4G.js.map
